(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{"/h46":function(e,t,n){n("cHUd")("Map")},DCPb:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("ODRq")),s=l(n("vDqi")),a=l(n("Ah+g")),o=l(n("i8o3")),r=l(n("0hVY")),c=n("CeR/");function l(e){return e&&e.__esModule?e:{default:e}}t.default={name:"FlowVersion",components:{searchInfo:a.default,preview:o.default},mixins:[r.default],data:function(){return{secondClick:!1,versionStatus:!0,isDataLoading:!1,normalColor:!0,trueStatus:!0,falseStatus:!1,dataList:[],pagination:{current:1,count:10,limit:10},checkList:[],moreSearch:[{name:this.$t('m.flowManager["流程名"]'),type:"input",typeKey:"name__contains",value:"",list:[]},{name:this.$t('m.flowManager["版本号"]'),type:"input",typeKey:"version_number__contains",value:"",list:[]},{name:this.$t('m.flowManager["发布人"]'),type:"member",typeKey:"updated_by__contains",multiSelect:!0,value:[],list:[]}],deleteInfo:{type:"",info:{}},processInfo:{isShow:!1,title:this.$t('m.flowManager["流程预览"]'),position:{top:150},draggable:!0,loading:!0,version:"version",addList:[]},previewInfo:{canClick:!1,narrowSize:.8},addList:[],lineList:[]}},computed:{sliderStatus:function(){return this.$store.state.common.slideStatus}},mounted:function(){this.getList()},methods:{getList:function(e){var t=this;void 0!==e&&(this.pagination.current=e),this.checkList=[];var n={page:this.pagination.current,page_size:this.pagination.limit};this.moreSearch.forEach((function(e){(Array.isArray(e.value)?e.value.length:e.value)&&(n[e.typeKey]=Array.isArray(e.value)?e.value.join(","):e.value)})),this.isDataLoading=!0,this.$store.dispatch("workflowVersion/list",n).then((function(e){t.dataList=e.data.items,t.dataList.forEach((function(e){t.$set(e,"checkStatus",!1)})),t.pagination.current=e.data.page,t.pagination.count=e.data.count})).catch((function(e){(0,c.errorHandler)(e,t)})).finally((function(){t.isDataLoading=!1}))},handlePageLimitChange:function(){this.pagination.limit=arguments[0],this.getList()},handlePageChange:function(e){this.pagination.current=e,this.getList()},handleSelectAll:function(e){var t=this;this.dataList.forEach((function(n){!n.service_cnt&&t.hasPermission(["flow_version_manage"],n.auth_actions)&&(n.checkStatus=!!e.length)})),this.checkList=e.filter((function(e){return t.hasPermission(["flow_version_manage"],e.auth_actions)}))},handleSelect:function(e,t){this.checkList=e},disabledFn:function(e,t){return!e.service_cnt},changeCheck:function(e){this.$refs.versionTable.toggleRowSelection(e,e.checkStatus),e.checkStatus?this.checkList.some((function(t){return t.id===e.id}))||this.checkList.push(e):this.checkList=this.checkList.filter((function(t){return t.id!==e.id}))},searchContent:function(){this.getList(1)},searchMore:function(){this.$refs.searchInfo.searchMore()},clearSearch:function(){this.moreSearch.forEach((function(e){e.value=e.multiSelect?[]:""})),this.getList(1)},changePageSize:function(){this.customPaging.page_size<5?this.customPaging.page_size=5:this.customPaging.page_size>100&&(this.customPaging.page_size=100),this.getList(1)},pageChange:function(e){this.customPaging.page=e,this.getList()},openConfirmDialog:function(e,t){var n=this;if(("delete"!==t||this.checkfowManagePermisson(e))&&("restore"!==t||this.checkfowRestorePermisson(e))){var s=new i.default([["delete",this.$t('m.flowManager["流程版本删除确认"]')],["restore",this.$t('m.flowManager["流程版本还原确认"]')],["export",this.$t('m.flowManager["流程版本导出确认"]')],["batchDelete",this.$t('m.flowManager["流程版本批量删除确认"]')]]),a=new i.default([["delete",this.$t('m.flowManager["删除之后服务将无法关联这些流程版本"]')],["restore",this.$t('m.flowManager["还原后请移步到流程设计处编辑"]')],["export",this.$t('m.flowManager["确认后将导出当前版本的流程数据为JSON格式的文件"]')],["batchDelete",this.$t('m.flowManager["删除之后服务将无法关联这些流程版本"]')]]);e.service_cnt&&"delete"===t||(this.deleteInfo.info=e,this.deleteInfo.type=t,this.$bkInfo({type:"warning",title:s.get(t),subTitle:a.get(t),confirmFn:function(){n.submitFn()}}))}},submitFn:function(){"delete"===this.deleteInfo.type?this.deleteSubmit():"restore"===this.deleteInfo.type?this.restoreSubmit():"export"===this.deleteInfo.type?this.exportSubmit():"batchDelete"===this.deleteInfo.type&&this.batchDeleteSubmit()},batchDeleteSubmit:function(){var e=this;if(!this.secondClick){this.secondClick=!0;var t=this.checkList.map((function(e){return e.id})).join(",");this.$store.dispatch("workflowVersion/batchDelete",{id:t}).then((function(t){e.$bkMessage({message:e.$t('m.flowManager["批量删除成功"]'),theme:"success"}),e.checkList=[],e.getList()})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.secondClick=!1}))}},deleteSubmit:function(){var e=this;this.secondClick||(this.secondClick=!0,this.$store.dispatch("workflowVersion/delete",this.deleteInfo.info.id).then((function(t){e.$bkMessage({message:e.$t('m.flowManager["删除成功"]'),theme:"success"}),e.getList(1)})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.secondClick=!1})))},restoreSubmit:function(){var e=this;this.secondClick||(this.secondClick=!0,this.$store.dispatch("workflowVersion/restore",this.deleteInfo.info.id).then((function(t){e.$bkMessage({message:e.$t('m.flowManager["成功还原该流程，请前往【流程设计】查看"]'),theme:"success"})})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.secondClick=!1})))},onFlowPreview:function(e){var t=this;if(this.checkfowManagePermisson(e)){var n=e.id;n&&(this.processInfo.isShow=!this.processInfo.isShow,this.processInfo.loading=!0,s.default.all([this.$store.dispatch("deployCommon/getNodeVersion",{id:n}),this.$store.dispatch("deployCommon/getLineVersion",{id:n})]).then(s.default.spread((function(e,n){t.addList=e.data;for(var i=0;i<t.addList.length;i++)t.addList[i].indexInfo=i;t.lineList=n.data.items}))).finally((function(){t.processInfo.loading=!1})))}},closeVersion:function(){this.versionStatus=!1},checkfowManagePermisson:function(e){if(!this.hasPermission(["flow_version_manage"],e.auth_actions)){var t=this.$store.state.project.projectInfo,n={project:[{id:t.key,name:t.name}],flow_version:[{id:e.id,name:e.name}]};return this.applyForPermission(["flow_version_manage"],e.auth_actions,n),!1}return!0},checkfowRestorePermisson:function(e){if(!this.hasPermission(["flow_version_restore"],e.auth_actions)){var t=this.$store.state.project.projectInfo,n={project:[{id:t.key,name:t.name}],flow_version:[{id:e.id,name:e.name}],workflow:[{id:e.workflow_id,name:e.name}]};return this.applyForPermission(["flow_version_restore"],e.auth_actions,n),!1}return!0}}}},IWSG:function(e,t,n){"use strict";n.r(t);var i=n("DCPb"),s=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t.default=s.a},ODRq:function(e,t,n){e.exports={default:n("UDep"),__esModule:!0}},S9aI:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"bk-itsm-service"},[n("div",{staticClass:"is-title",class:{"bk-title-left":!e.sliderStatus}},[n("p",{staticClass:"bk-come-back"},[e._v("\n            "+e._s(e.$t('m.flowManager["流程版本"]'))+"\n        ")])]),e._v(" "),n("div",{staticClass:"itsm-page-content"},[e.versionStatus?n("div",{staticClass:"bk-itsm-version"},[n("i",{staticClass:"bk-icon icon-info-circle"}),e._v(" "),n("span",[e._v(e._s(e.$t('m.flowManager["流程版本：由流程模板部署后即可生成"]')))]),e._v(" "),n("i",{staticClass:"bk-icon icon-close",on:{click:e.closeVersion}})]):e._e(),e._v(" "),n("div",{staticClass:"bk-only-btn"},[n("div",{staticClass:"bk-more-search"},[n("bk-button",{staticClass:"mr10",attrs:{theme:"primary",title:e.$t("m.flowManager['批量删除']"),disabled:!e.checkList.length},on:{click:function(t){return e.openConfirmDialog({},"batchDelete")}}},[e._v("\n                    "+e._s(e.$t("m.flowManager['批量删除']"))+"\n                ")]),e._v(" "),n("div",{staticClass:"bk-search-name"},[n("div",{staticClass:"bk-search-content"},[n("bk-input",{attrs:{clearable:!0,"right-icon":"bk-icon icon-search"},on:{enter:e.searchContent,clear:e.clearSearch},model:{value:e.moreSearch[0].value,callback:function(t){e.$set(e.moreSearch[0],"value",t)},expression:"moreSearch[0].value"}})],1),e._v(" "),n("bk-button",{staticClass:"ml10 filter-btn",attrs:{title:e.$t("m.deployPage['更多筛选条件']"),icon:" bk-itsm-icon icon-search-more"},on:{click:e.searchMore}})],1)],1),e._v(" "),n("search-info",{ref:"searchInfo",attrs:{"more-search":e.moreSearch}})],1),e._v(" "),n("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isDataLoading},expression:"{ isLoading: isDataLoading }"}],ref:"versionTable",attrs:{data:e.dataList,size:"small",pagination:e.pagination},on:{"page-change":e.handlePageChange,"page-limit-change":e.handlePageLimitChange,"select-all":e.handleSelectAll,select:e.handleSelect}},[n("bk-table-column",{attrs:{type:"selection",width:"60",align:"center",selectable:e.disabledFn},scopedSlots:e._u([{key:"default",fn:function(t){return[e.hasPermission(["flow_version_manage"],t.row.auth_actions)?[n("bk-checkbox",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:{content:e.$t("m.flowManager['流程已绑定服务，不能进行删除操作']"),disabled:!t.row.service_cnt},expression:"{\n                                content: $t(`m.flowManager['流程已绑定服务，不能进行删除操作']`),\n                                disabled: !props.row.service_cnt\n                            }",modifiers:{top:!0}}],attrs:{"true-value":e.trueStatus,"false-value":e.falseStatus,disabled:!!t.row.service_cnt},on:{change:function(n){return e.changeCheck(t.row)}},model:{value:t.row.checkStatus,callback:function(n){e.$set(t.row,"checkStatus",n)},expression:"props.row.checkStatus"}})]:[n("div",{staticStyle:{height:"100%",display:"flex","justify-content":"center","align-items":"center"}},[n("span",{directives:[{name:"cursor",rawName:"v-cursor"}],staticClass:"checkbox-permission-disable",on:{click:function(n){return e.checkfowManagePermisson(t.row)}}})])]]}}])}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("m.common['ID']"),"min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{attrs:{title:t.row.id}},[e._v(e._s(t.row.id||"--"))])]}}])}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("m.flowManager['流程名']"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{attrs:{title:t.row.name}},[e._v(e._s(t.row.name||"--"))])]}}])}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("m.flowManager['版本号']"),"min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{attrs:{title:t.row.version_number}},[e._v(e._s(t.row.version_number||"--"))])]}}])}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("m.flowManager['发布人']")},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{attrs:{title:t.row.updated_by}},[e._v(e._s(t.row.updated_by||"--"))])]}}])}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("m.flowManager['发布时间']"),"min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{attrs:{title:t.row.update_at}},[e._v(e._s(t.row.update_at||"--"))])]}}])}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("m.flowManager['关联服务数']"),width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{attrs:{title:t.row.service_cnt}},[e._v(e._s(t.row.service_cnt||"--"))])]}}])}),e._v(" "),n("bk-table-column",{attrs:{label:e.$t("m.flowManager['操作']"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission(["flow_version_manage"],t.row.auth_actions)},expression:"{ active: !hasPermission(['flow_version_manage'], props.row.auth_actions) }"}],class:[{"btn-permission-disable":!e.hasPermission(["flow_version_manage"],t.row.auth_actions)}],attrs:{text:"",theme:"primary",title:e.$t("m.flowManager['预览']")},on:{click:function(n){return e.onFlowPreview(t.row)}}},[e._v("\n                        "+e._s(e.$t('m.flowManager["预览"]'))+"\n                    ")]),e._v(" "),n("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission(["flow_version_restore"],t.row.auth_actions)},expression:"{ active: !hasPermission(['flow_version_restore'], props.row.auth_actions) }"}],class:[{"btn-permission-disable":!e.hasPermission(["flow_version_restore"],t.row.auth_actions)}],attrs:{text:"",theme:"primary",title:e.$t("m.flowManager['还原']")},on:{click:function(n){return e.openConfirmDialog(t.row,"restore")}}},[e._v("\n                        "+e._s(e.$t('m.flowManager["还原"]'))+"\n                    ")]),e._v(" "),n("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission(["flow_version_manage"],t.row.auth_actions)},expression:"{ active: !hasPermission(['flow_version_manage'], props.row.auth_actions) }"}],class:[{"btn-permission-disable":!e.hasPermission(["flow_version_manage"],t.row.auth_actions)}],attrs:{text:"",theme:"primary",title:e.$t("m.flowManager['删除']"),disabled:e.hasPermission(["flow_version_manage"],t.row.auth_actions)&&!!t.row.service_cnt},on:{click:function(n){return e.openConfirmDialog(t.row,"delete")}}},[e._v("\n                        "+e._s(e.$t('m.flowManager["删除"]'))+"\n                    ")])]}}])})],1)],1),e._v(" "),n("bk-dialog",{attrs:{width:"760",position:e.processInfo.position,draggable:e.processInfo.draggable,title:e.processInfo.title},model:{value:e.processInfo.isShow,callback:function(t){e.$set(e.processInfo,"isShow",t)},expression:"processInfo.isShow"}},[n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.processInfo.loading},expression:"{ isLoading: processInfo.loading }"}],staticStyle:{width:"100%",height:"347px"}},[e.processInfo.loading?e._e():n("preview",{attrs:{"add-list":e.addList,"line-list":e.lineList,"preview-info":e.previewInfo,"normal-color":e.normalColor}})],1),e._v(" "),n("div",{attrs:{slot:"footer"},slot:"footer"},[n("bk-button",{attrs:{theme:"default"},on:{click:function(t){e.processInfo.isShow=!1}}},[e._v("\n                "+e._s(e.$t('m.deployPage["关闭"]'))+"\n            ")])],1)])],1)},s=[];i._withStripped=!0},UDep:function(e,t,n){n("wgeU"),n("FlQf"),n("bBy9"),n("g33z"),n("XLbu"),n("/h46"),n("dVTT"),e.exports=n("WEpk").Map},XLbu:function(e,t,n){var i=n("Y7ZC");i(i.P+i.R,"Map",{toJSON:n("8iia")("Map")})},dVTT:function(e,t,n){n("aPfg")("Map")},g33z:function(e,t,n){"use strict";var i=n("Wu5q"),s=n("n3ko");e.exports=n("raTm")("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=i.getEntry(s(this,"Map"),e);return t&&t.v},set:function(e,t){return i.def(s(this,"Map"),0===e?0:e,t)}},i,!0)},szot:function(e,t,n){"use strict";n.r(t);var i=n("S9aI"),s=n("IWSG");for(var a in s)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return s[e]}))}(a);n("yWk8");var o=n("KHd+"),r=Object(o.a)(s.default,i.a,i.b,!1,null,"6c674f74",null);r.options.__file="src/views/processManagement/version/index.vue",t.default=r.exports},uWl6:function(e,t,n){},yWk8:function(e,t,n){"use strict";n("uWl6")}}]);