(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{"+61f":function(t,e,n){"use strict";n.r(e);var i=n("zg2j"),s=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e.default=s.a},"+iU5":function(t,e,n){"use strict";n.r(e);var i=n("XpQX"),s=n("+61f");for(var a in s)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(a);n("BBpA");var o=n("KHd+"),c=Object(o.a)(s.default,i.a,i.b,!1,null,"56399009",null);c.options.__file="src/views/service/directoryCom/treeTable.vue",e.default=c.exports},"4rOh":function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return s}));var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"bk-itsm-service"},[n("div",{staticClass:"is-title",class:{"bk-title-left":!t.sliderStatus}},[n("p",{staticClass:"bk-come-back"},[n("span",[t._v(t._s(t.$t('m.serviceConfig["服务目录"]')))])])]),t._v(" "),n("div",{staticClass:"itsm-page-content service-directory"},[n("div",{staticClass:"bk-directory-tree"},[n("tree-info",{ref:"treeContent",attrs:{"tree-info":t.treeInfo}})],1),t._v(" "),n("div",{staticClass:"bk-directory-table"},[n("tree-table",{ref:"tableContent",attrs:{"tree-info":t.treeInfo}})],1)])])},s=[];i._withStripped=!0},BBpA:function(t,e,n){"use strict";n("W9Z/")},E3eJ:function(t,e,n){"use strict";n.r(e);var i=n("4rOh"),s=n("lFDy");for(var a in s)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return s[t]}))}(a);n("f9AG");var o=n("KHd+"),c=Object(o.a)(s.default,i.a,i.b,!1,null,"5f028369",null);c.options.__file="src/views/service/directory.vue",e.default=c.exports},"W9Z/":function(t,e,n){},XpQX:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return s}));var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"bk-tree-table-directory"},[n("div",{staticClass:"bk-table-search"},[n("div",{staticClass:"bk-search-word"},[n("span",[t._v(t._s(t.nameInfo))])]),t._v(" "),t.treeInfo.node.level?n("div",{staticClass:"bk-form-content"},[n("bk-button",{staticClass:"mr10 plus-cus",attrs:{theme:"primary","data-test-id":"serviceCatalogue_button_create",title:t.$t("m.managePage['新增']"),icon:"plus"},on:{click:t.openShade}},[t._v("\n                "+t._s(t.$t("m.managePage['新增']"))+"\n            ")]),t._v(" "),n("bk-button",{staticClass:"mr10",attrs:{theme:"default","data-test-id":"serviceCatalogue_button_batchDelete",title:t.$t("m.serviceConfig['批量移除']"),disabled:!t.checkList.length},on:{click:t.deleteCheck}},[t._v("\n                "+t._s(t.$t("m.serviceConfig['批量移除']"))+"\n            ")]),t._v(" "),n("div",{staticClass:"bk-search-input"},[n("bk-input",{attrs:{"data-test-id":"serviceCatalogue_input_searchKey",placeholder:t.$t("m.serviceConfig['请输入关键字']"),clearable:!0,"right-icon":"bk-icon icon-search"},on:{enter:t.serchEntry,clear:t.clearInfo},model:{value:t.searchInfo.key,callback:function(e){t.$set(t.searchInfo,"key",e)},expression:"searchInfo.key"}})],1)],1):t._e()]),t._v(" "),n("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isTableLoading},expression:"{ isLoading: isTableLoading }"}],staticClass:"mt15 bk-draggable"},[n("table",{staticClass:"bk-draggable-table",attrs:{"data-test-id":"serviceCatalogue_table_drag"}},[n("thead",[n("tr",[t.listInfo.length?n("th",[n("bk-checkbox",{attrs:{"data-test-id":"directiory-checkbox-check","true-value":t.trueStatus,"false-value":t.falseStatus},on:{change:t.handleSelectAll},model:{value:t.allCheck,callback:function(e){t.allCheck=e},expression:"allCheck"}})],1):t._e(),t._v(" "),n("th",[t._v("No.")]),t._v(" "),n("th",{staticStyle:{"min-width":"130px","max-width":"300px"}},[t._v(t._s(t.$t('m.serviceConfig["服务名称"]')))]),t._v(" "),n("th",{staticStyle:{"min-width":"100px","max-width":"300px"}},[t._v(t._s(t.$t('m.serviceConfig["服务类型"]')))]),t._v(" "),n("th",{staticStyle:{"min-width":"100px"}},[t._v(t._s(t.$t('m.deployPage["状态"]')))]),t._v(" "),n("th",{staticStyle:{"max-width":"250px"}},[t._v(t._s(t.$t('m.serviceConfig["服务说明"]')))]),t._v(" "),n("th",{staticStyle:{"min-width":"100px"}},[t._v(t._s(t.$t('m.serviceConfig["操作"]')))])])]),t._v(" "),n("draggable",{attrs:{tag:"tbody",handle:".move-handler-content"},on:{end:t.updateInfo},model:{value:t.listInfo,callback:function(e){t.listInfo=e},expression:"listInfo"}},[t.listInfo.length?t._l(t.listInfo,(function(e,i){return n("tr",{key:i,class:{"move-handler-content":!t.searchInfo.key}},[n("td",[n("bk-checkbox",{attrs:{"data-test-id":"service_checkbox_check","true-value":t.trueStatus,"false-value":t.falseStatus},on:{change:function(n){return t.handleSelect(e,i)}},model:{value:e.checkValue,callback:function(n){t.$set(e,"checkValue",n)},expression:"item.checkValue"}})],1),t._v(" "),n("td",[n("span",[t._v(t._s(i+1))])]),t._v(" "),n("td",{staticStyle:{"min-width":"130px","max-width":"300px"},attrs:{title:e.name}},[n("span",[t._v(t._s(e.name||"--"))])]),t._v(" "),n("td",{staticStyle:{"min-width":"100px","max-width":"300px"}},t._l(t.serviceTypesMap,(function(i){return e.key===i.key?n("span",{key:i.key,attrs:{title:i.name}},[t._v("\n                                "+t._s(i.name||"--")+"\n                            ")]):t._e()})),0),t._v(" "),n("td",[n("span",{staticClass:"bk-status-color",class:{"bk-status-gray":!e.is_valid}}),t._v(" "),n("span",{staticStyle:{"margin-left":"5px"},attrs:{title:e.is_valid?t.$t("m.deployPage['启用']"):t.$t("m.deployPage['关闭']")}},[t._v("\n                                "+t._s(e.is_valid?t.$t('m.deployPage["启用"]'):t.$t('m.deployPage["关闭"]'))+"\n                            ")])]),t._v(" "),n("td",{staticStyle:{"min-width":"120px"},attrs:{title:e.desc}},[n("div",{staticClass:"bk-overflow-line"},[n("span",{attrs:{title:e.desc}},[t._v(t._s(e.desc||"--"))])])]),t._v(" "),n("td",{staticStyle:{"min-width":"100px"}},[n("bk-button",{attrs:{"data-test-id":"serviceCatalogue_button_deleteService",theme:"primary",text:""},on:{click:function(n){return t.deleteOne(e)}}},[t._v("\n                                "+t._s(t.$t('m.serviceConfig["移除"]'))+"\n                            ")])],1)])})):[n("tr",{},[n("td",{staticClass:"bk-none-content",attrs:{colspan:"10"}},[n("i",{staticClass:"bk-table-empty-icon bk-icon icon-empty"}),t._v(" "),n("p",{staticClass:"bk-none-info"},[t._v(t._s(t.$t('m.treeinfo["暂无数据"]')))])])])]],2)],1)]),t._v(" "),n("bk-sideslider",{attrs:{"is-show":t.entryInfo.show,title:t.entryInfo.title,width:t.entryInfo.width,"quick-close":!0},on:{"update:isShow":function(e){return t.$set(t.entryInfo,"show",e)},"update:is-show":function(e){return t.$set(t.entryInfo,"show",e)}}},[t.entryInfo.show?n("div",{staticStyle:{padding:"20px"},attrs:{slot:"content"},slot:"content"},[n("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isDataLoading},expression:"{ isLoading: isDataLoading }"}],attrs:{data:t.entryInfo.listInfo,size:"small",pagination:t.entryInfo.pagination},on:{"page-change":t.addPageChange,"page-limit-change":t.addPageLimitChange,"select-all":t.addSelectAll,select:t.addSelect}},[n("bk-table-column",{attrs:{type:"selection",width:"60",align:"center"}}),t._v(" "),n("bk-table-column",{attrs:{type:"index",label:"NO.",align:"center",width:"60"}}),t._v(" "),n("bk-table-column",{attrs:{label:t.$t("m.serviceConfig['服务名称']"),prop:"name","min-width":"180"}}),t._v(" "),n("bk-table-column",{attrs:{label:t.$t("m.serviceConfig['服务类型']")},scopedSlots:t._u([{key:"default",fn:function(e){return t._l(t.serviceTypesMap,(function(i){return e.row.key===i.key?n("span",{key:i.key},[t._v("\n                            "+t._s(i.name||"--")+"\n                        ")]):t._e()}))}}],null,!1,512926593)})],1),t._v(" "),n("div",{staticClass:"mt20"},[t.entryInfo.listInfo.length?n("bk-button",{attrs:{"data-test-id":"serviceCatalogue_button_serviceConfirm",theme:"primary",title:t.$t("m.serviceConfig['确认']"),disabled:!t.entryInfo.checkList.length,loading:t.secondClick},on:{click:t.submitEntry}},[t._v("\n                    "+t._s(t.$t('m.serviceConfig["确认"]'))+"\n                ")]):n("bk-button",{attrs:{"data-test-id":"serviceCatalogue_button_serviceCreate",theme:"primary",title:t.$t("m.serviceConfig['新增']")},on:{click:t.addEntry}},[t._v("\n                    "+t._s(t.$t('m.serviceConfig["新增"]'))+"\n                ")]),t._v(" "),n("bk-button",{attrs:{"data-test-id":"serviceCatalogue_button_serviceCancel",theme:"default",title:t.$t("m.serviceConfig['取消']"),loading:t.secondClick},on:{click:t.closeShade}},[t._v("\n                    "+t._s(t.$t('m.serviceConfig["取消"]'))+"\n                ")])],1)],1):t._e()])],1)},s=[];i._withStripped=!0},f9AG:function(t,e,n){"use strict";n("owAp")},fA3Z:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=a(n("fnP/")),s=a(n("+iU5"));function a(t){return t&&t.__esModule?t:{default:t}}e.default={components:{treeInfo:i.default,treeTable:s.default},data:function(){return{treeInfo:{node:{}}}},computed:{sliderStatus:function(){return this.$store.state.common.slideStatus}}}},lFDy:function(t,e,n){"use strict";n.r(e);var i=n("fA3Z"),s=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e.default=s.a},owAp:function(t,e,n){},zg2j:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,s=n("t2rG"),a=(i=s)&&i.__esModule?i:{default:i},o=n("CeR/");e.default={components:{draggable:a.default},props:{treeInfo:{type:Object,default:function(){return{node:{}}}}},data:function(){return{isDataLoading:!1,isTableLoading:!1,trueStatus:!0,falseStatus:!1,allCheck:!1,secondClick:!1,searchInfo:{key:""},serviceTypesMap:{},checkList:[],listInfo:[],entryInfo:{show:!1,title:this.$t('m.serviceConfig["添加服务"]'),width:700,listInfo:[],pagination:{current:1,count:10,limit:10},checkList:[]},nameInfo:""}},watch:{"treeInfo.node":function(){this.getTableList()}},mounted:function(){this.getServiceTypes(),this.getTableList()},methods:{getServiceTypes:function(){var t=this;this.$store.dispatch("getCustom").then((function(e){t.serviceTypesMap=e.data})).catch((function(e){(0,o.errorHandler)(e,t)}))},getTableList:function(){var t=this,e=[];this.treeInfo.node.route&&this.treeInfo.node.route.length&&this.treeInfo.node.route.forEach((function(t){e.push(t.name)})),e.push(this.treeInfo.node.name),this.nameInfo=e.join(" / "),this.isTableLoading=!0,this.checkList=[];var n={catalog_id:this.treeInfo.node.id,name:this.searchInfo.key,project_key:this.$store.state.project.id};this.treeInfo.node.id&&this.$store.dispatch("catalogService/getServices",n).then((function(e){t.listInfo=e.data,t.listInfo.forEach((function(e){t.$set(e,"checkValue",!1)}))})).catch((function(e){(0,o.errorHandler)(e,t)})).finally((function(){t.isTableLoading=!1}))},handleSelectAll:function(t){this.checkList=t?this.listInfo:[],this.listInfo.forEach((function(e){e.checkValue=t}))},handleSelect:function(t,e){t.checkValue?this.checkList.push(t):this.checkList=this.checkList.filter((function(e){return e.id!==t.id})),this.allCheck=this.checkList.length===this.listInfo.length},updateInfo:function(t){var e=this,n=this.listInfo[t.newIndex],i=this.listInfo.map((function(t){return t.id}));if(!this.secondClick&&n.bounded_relations[0]){this.secondClick=!0;var s={new_order:i},a=n.bounded_relations[0].bond_id;this.$store.dispatch("serviceCatalog/moveTableNode",{params:s,id:a}).then((function(t){})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.secondClick=!1}))}},serchEntry:function(){this.getTableList()},clearInfo:function(){this.searchInfo.key="",this.getTableList()},deleteOne:function(t){var e={catalog_id:this.treeInfo.node.id,services:[t.id]};this.deleteSubmit(e)},deleteCheck:function(){var t=this.checkList.map((function(t){return t.id})),e={catalog_id:this.treeInfo.node.id,services:t};this.deleteSubmit(e)},deleteSubmit:function(t){var e=this;this.$bkInfo({type:"warning",title:this.$t('m.serviceConfig["确认移除服务？"]'),subTitle:this.$t('m.serviceConfig["移除后，将无法在该目录下找到该服务，请谨慎操作"]'),confirmFn:function(){e.secondClick||(e.secondClick=!0,e.$store.dispatch("catalogService/removeServices",t).then((function(t){e.$bkMessage({message:e.$t('m.serviceConfig["删除成功"]'),theme:"success"}),e.getTableList()})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.secondClick=!1})))}})},openShade:function(){this.getEntryList(),this.closeShade()},closeShade:function(){this.entryInfo.show=!this.entryInfo.show,this.entryInfo.allCheck=!1},submitEntry:function(){var t=this,e={catalog_id:this.treeInfo.node.id,services:this.entryInfo.checkList.map((function(t){return t.id})),project_key:this.$store.state.project.id};this.secondClick||(this.secondClick=!0,this.$store.dispatch("catalogService/addServices",e).then((function(e){t.$bkMessage({message:t.$t('m.serviceConfig["添加成功"]'),theme:"success"}),t.getTableList(),t.closeShade()})).catch((function(e){(0,o.errorHandler)(e,t)})).finally((function(){t.secondClick=!1})))},addEntry:function(){this.$router.push({name:"projectServiceList",query:{project_id:this.$store.state.project.id}})},getEntryList:function(t){var e=this;void 0!==t&&(this.entryInfo.pagination.current=t),this.entryInfo.checkList=[];var n={page:this.entryInfo.pagination.current,page_size:this.entryInfo.pagination.limit,no_classified:!0,is_valid:!0,project_key:this.$store.state.project.id};this.isDataLoading=!0,this.$store.dispatch("serviceEntry/getList",n).then((function(t){e.entryInfo.listInfo=t.data.items,e.entryInfo.pagination.current=t.data.page,e.entryInfo.pagination.count=t.data.count})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.isDataLoading=!1}))},addPageLimitChange:function(){this.entryInfo.pagination.limit=arguments[0],this.getEntryList()},addPageChange:function(t){this.entryInfo.pagination.current=t,this.getEntryList()},addSelectAll:function(t){this.entryInfo.checkList=t},addSelect:function(t,e){this.entryInfo.checkList=t}}}}}]);