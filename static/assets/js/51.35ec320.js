(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{"HA+k":function(t,e,i){},R9aT:function(t,e,i){"use strict";i.r(e);var o=i("r/Ix"),n=i.n(o);for(var r in o)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return o[t]}))}(r);e.default=n.a},VmT6:function(t,e,i){"use strict";i("HA+k")},ftgJ:function(t,e,i){"use strict";i.d(e,"a",(function(){return o})),i.d(e,"b",(function(){return n}));var o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"project-list-page"},[i("i",{staticClass:"bk-icon icon-close-line-2 back-icon",on:{click:t.handleGoBack}}),t._v(" "),i("div",{staticClass:"action-wrap"},[i("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.hasPermission(["project_create"])},expression:"{ active: !hasPermission(['project_create']) }"}],class:[{"btn-permission-disable":!t.hasPermission(["project_create"])}],attrs:{theme:"primary"},on:{click:t.onCreateProject}},[t._v("\n            "+t._s(t.$t('m["新建"]'))+"\n        ")]),t._v(" "),i("bk-input",{staticStyle:{width:"530px"},attrs:{"right-icon":"bk-icon icon-search",placeholder:t.$t("m['请输入项目名称']")},on:{enter:t.onSearchProject,clear:t.onSearchProject},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}})],1),t._v(" "),i("div",{staticClass:"project-table"},[i("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.listLoading},expression:"{ isLoading: listLoading }"}],attrs:{data:t.list,pagination:t.pagination},on:{"sort-change":t.handleSortChange,"page-change":t.handlePageChange,"page-limit-change":t.handlePageLimitChange}},[i("bk-table-column",{attrs:{prop:"name",label:t.$t("m['项目名称']")},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticClass:"name-wrap"},[i("span",{staticClass:"prefix-icon",style:{background:e.row.color||"#90a1ff"}},[t._v("\n                            "+t._s(e.row.name[0].toUpperCase())+"\n                        ")]),t._v(" "),i("span",{staticClass:"text"},[t._v(t._s(e.row.name))])])]}}])}),t._v(" "),i("bk-table-column",{attrs:{prop:"key",label:t.$t("m['项目代号']")}}),t._v(" "),i("bk-table-column",{attrs:{prop:"desc",label:t.$t("m['项目说明']")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.desc||"--")+"\n                ")]}}])}),t._v(" "),i("bk-table-column",{attrs:{prop:"creator",label:t.$t("m['创建人']")}}),t._v(" "),i("bk-table-column",{attrs:{sortable:!0,prop:"create_at",label:t.$t("m['创建时间']")}}),t._v(" "),i("bk-table-column",{attrs:{label:t.$t("m['操作']")},scopedSlots:t._u([{key:"default",fn:function(e){return[i("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.hasPermission(["project_edit"],e.row.auth_actions)},expression:"{ active: !hasPermission(['project_edit'], props.row.auth_actions) }"}],class:{"btn-permission-disable":!t.hasPermission(["project_edit"],e.row.auth_actions)},attrs:{text:"",theme:"primary"},on:{click:function(i){return t.onEditProject(e)}}},[t._v("\n                        "+t._s(t.$t("m['编辑']"))+"\n                    ")]),t._v(" "),i("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:t.$t("m['该项目不允许删除']"),expression:"$t(`m['该项目不允许删除']`)",modifiers:{right:!0}}],style:{display:"inline-block"}},[i("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.hasPermission(["project_edit"],e.row.auth_actions)},expression:"{ active: !hasPermission(['project_edit'], props.row.auth_actions) }"}],class:{"btn-permission-disable":!t.hasPermission(["project_edit"],e.row.auth_actions)},attrs:{text:"",theme:"primary",disabled:!0},on:{click:function(i){return t.onDeleteProject(e.row)}}},[t._v("\n                            "+t._s(t.$t("m['删除']"))+"\n                        ")])],1)]}}])})],1)],1),t._v(" "),i("edit-project-dialog",{attrs:{title:t.editDialogTitle,"is-show":t.isEditDialogShow,project:t.projectForm},on:{confirm:t.onProjectDialogConfirm,cancel:t.onProjectDialogCancel}}),t._v(" "),i("bk-dialog",{attrs:{"header-position":"center","render-directive":"if",title:t.$t("m['确认删除项目？']"),width:400,"auto-close":!1,"mask-close":!1,loading:t.deleteProjectPending},on:{confirm:t.onDeleteProjectConfirm,cancel:function(e){t.editingProject=null}},model:{value:t.isDeleteDialogShow,callback:function(e){t.isDeleteDialogShow=e},expression:"isDeleteDialogShow"}},[t.editingProject?i("div",{staticClass:"delete-tips"},[t._v("\n            "+t._s(t.$t("m['确认删除']"))+t._s(t.$t("m['“']"))+t._s(t.editingProject.name)+t._s(t.$t("m['”']"))+t._s(t.$t("m['，']"))+t._s(t.$t("m['一旦删除将不可回复，请谨慎操作。']"))+"\n        ")]):t._e()])],1)},n=[];o._withStripped=!0},g7fZ:function(t,e,i){"use strict";i.r(e);var o=i("ftgJ"),n=i("R9aT");for(var r in n)["default"].indexOf(r)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(r);i("VmT6");var a=i("KHd+"),s=Object(a.a)(n.default,o.a,o.b,!1,null,"389760ee",null);s.options.__file="src/views/project/list.vue",e.default=s.exports},"r/Ix":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=d(i("P2sY")),n=d(i("14Xm")),r=d(i("D3Ub")),a=d(i("EstQ")),s=i("CeR/"),c=d(i("0hVY")),l=d(i("Ez9R"));function d(t){return t&&t.__esModule?t:{default:t}}e.default={name:"ProjectList",components:{EditProjectDialog:l.default},mixins:[c.default],data:function(){return{keyword:"",list:[],listLoading:!1,ordering:void 0,editingProject:null,isEditDialogShow:!1,isDeleteDialogShow:!1,editProjectPending:!1,deleteProjectPending:!1,projectForm:{name:"",key:"",desc:"",color:""},pagination:{current:1,count:0,limit:10}}},computed:{editDialogTitle:function(){return this.editingProject?a.default.t('m["编辑项目"]'):a.default.t('m["新建项目"]')}},created:function(){this.getProjectList()},beforeRouteEnter:function(t,e,i){e.name&&(window.previousRouter=e.fullPath),i()},beforeRouteLeave:function(t,e,i){window.previousRouter=null,i()},methods:{getProjectList:function(){var t=this;return(0,r.default)(n.default.mark((function e(){var i,o,r,a,c;return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.listLoading=!0,e.prev=1,i=t.pagination,o=i.current,r=i.limit,a={page_size:r,page:o,ordering:t.ordering},""!==t.keyword&&(a.name__icontains=t.keyword),e.next=7,t.$store.dispatch("project/getProjectList",a);case 7:c=e.sent,t.pagination.count=c.data.count,t.list=c.data.items,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),(0,s.errorHandler)(e.t0,t);case 15:return e.prev=15,t.listLoading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,t,[[1,12,15,18]])})))()},getNameColor:function(t){return["#90a1ff","#bb90ff","#ffd990"][t]},onSearchProject:function(){this.pagination.current=1,this.getProjectList()},onCreateProject:function(){this.hasPermission(["project_create"])?(this.isEditDialogShow=!0,this.projectForm={name:"",key:"",desc:"",color:this.getNameColor(this.pagination.count%3)},this.editingProject=null):this.applyForPermission(["project_create"],[],{})},onEditProject:function(t){if(this.editingProject=t.row,!this.hasPermission(["project_edit"],this.editingProject.auth_actions)){var e={project:[{id:this.editingProject.key,name:this.editingProject.name}]};return this.applyForPermission(["project_edit"],this.editingProject.auth_actions,e),!1}this.projectForm=(0,o.default)({},t.row),this.projectForm.color||(this.projectForm.color=this.getNameColor(t.$index%3)),this.isEditDialogShow=!0},onProjectDialogConfirm:function(){this.isEditDialogShow=!1,this.getProjectList()},onProjectDialogCancel:function(){this.isEditDialogShow=!1},onDeleteProject:function(t){if(!this.hasPermission(["project_edit"],t.auth_actions)){var e={project:[{id:t.key,name:t.name}]};return this.applyForPermission(["project_edit"],t.auth_actions,e),!1}this.editingProject=t,this.isDeleteDialogShow=!0},onDeleteProjectConfirm:function(){var t=this;return(0,r.default)(n.default.mark((function e(){return n.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.deleteProjectPending=!0,e.prev=1,e.next=4,t.$store.dispatch("project/deleteProject",t.editingProject.key);case 4:t.editingProject=null,t.isDeleteDialogShow=!1,1===t.list.length&&(t.pagination.current=1===t.pagination.current?1:t.pagination.current-1),t.getProjectList(),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(1),(0,s.errorHandler)(e.t0,t);case 13:return e.prev=13,t.deleteProjectPending=!1,e.finish(13);case 16:case"end":return e.stop()}}),e,t,[[1,10,13,16]])})))()},handleSortChange:function(t){"ascending"===t.order||"descending"===t.order?this.ordering=t.prop:this.ordering=void 0,this.getProjectList()},handlePageChange:function(t){this.pagination.current=t,this.getProjectList()},handlePageLimitChange:function(t){this.pagination.limit=t,this.pagination.current=1,this.getProjectList()},handleGoBack:function(){window.previousRouter?this.$router.push(window.previousRouter):this.$router.push({name:"Home"})}}}}}]);