(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{"//gz":function(t,e,s){"use strict";s.r(e);var i=s("SBpE"),a=s.n(i);for(var n in i)["default"].indexOf(n)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(n);e.default=a.a},"4oWx":function(t,e,s){},DXNB:function(t,e,s){"use strict";s.r(e);var i=s("wK6c"),a=s("x9rO");for(var n in a)["default"].indexOf(n)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(n);s("tUm2");var o=s("KHd+"),r=Object(o.a)(a.default,i.a,i.b,!1,null,"7077a544",null);r.options.__file="src/views/slaManager/ticketStatus.vue",e.default=r.exports},Dg4g:function(t,e,s){"use strict";s("OmKX")},"IJ+s":function(t,e,s){"use strict";s.d(e,"a",(function(){return i})),s.d(e,"b",(function(){return a}));var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isDataLoading},expression:"{ isLoading: isDataLoading }"}],staticClass:"bk-design-first"},[s("div",{staticClass:"bk-only-btn"},[s("div",{staticClass:"bk-more-search"},[s("bk-button",{staticClass:"mr10 plus-cus",attrs:{theme:"primary",title:t.$t("m.deployPage['新增']"),icon:"plus"},on:{click:function(e){return t.statusDialog("add")}}},[t._v("\n                "+t._s(t.$t('m.deployPage["新增"]'))+"\n            ")])],1)]),t._v(" "),s("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isDataLoading},expression:"{ isLoading: isDataLoading }"}],attrs:{data:t.statusTable,size:"small"}},[s("bk-table-column",{attrs:{label:t.$t("m.slaContent['状态名']"),"min-width":150},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"bk-lable-primary",on:{click:function(s){return t.statusDialog("edit",e.row,e.$index)}}},[t._v("\n                    "+t._s(e.row.name)+"\n                ")])]}}])}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("m.slaContent['状态说明']"),width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(e.row.desc||"--")+"\n            ")]}}])}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("m.slaContent['起始状态']")},scopedSlots:t._u([{key:"default",fn:function(e){return["RUNNING"!==e.row.flow_status||e.row.is_over?t._e():[s("bk-radio",{on:{change:function(s){return t.selectOrigin(e.row)}},model:{value:e.row.is_start,callback:function(s){t.$set(e.row,"is_start",s)},expression:"props.row.is_start"}})],t._v(" "),"RUNNING"!==e.row.flow_status||e.row.is_over?[s("bk-radio",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.row.is_over?t.$t("m.slaContent['起始状态与结束状态互斥']"):t.$t("m.slaContent['非流转类型的状态不可编辑起始状态']"),expression:"props.row.is_over ? $t(`m.slaContent['起始状态与结束状态互斥']`) : $t(`m.slaContent['非流转类型的状态不可编辑起始状态']`)",modifiers:{top:!0}}],attrs:{disabled:t.trueStatus},model:{value:e.row.is_start,callback:function(s){t.$set(e.row,"is_start",s)},expression:"props.row.is_start"}})]:t._e()]}}])}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("m.slaContent['结束状态']")},scopedSlots:t._u([{key:"default",fn:function(e){return["RUNNING"!==e.row.flow_status||e.row.is_start?t._e():[s("bk-checkbox",{staticClass:"bk-outline-none",attrs:{"true-value":t.trueStatus,"false-value":t.falseStatus},model:{value:e.row.is_over,callback:function(s){t.$set(e.row,"is_over",s)},expression:"props.row.is_over"}})],t._v(" "),"RUNNING"!==e.row.flow_status||e.row.is_start?[s("bk-checkbox",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.row.is_start?t.$t("m.slaContent['起始状态与结束状态互斥']"):t.$t("m.slaContent['非流转类型的状态不可编辑起始状态']"),expression:"props.row.is_start ? $t(`m.slaContent['起始状态与结束状态互斥']`) : $t(`m.slaContent['非流转类型的状态不可编辑起始状态']`)",modifiers:{top:!0}}],staticClass:"bk-outline-none",attrs:{"true-value":t.trueStatus,"false-value":t.falseStatus,disabled:t.trueStatus},model:{value:e.row.is_over,callback:function(s){t.$set(e.row,"is_over",s)},expression:"props.row.is_over"}})]:t._e()]}}])}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("m.slaContent['状态颜色']")},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"status-color",style:{color:e.row.color_hex,"border-color":e.row.color_hex},attrs:{title:e.row.color_hex}},[t._v("\n                    "+t._s(e.row.name)+"\n                ")])]}}])}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("m.treeinfo['操作']"),width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("bk-button",{attrs:{theme:"primary",text:""},on:{click:function(s){return t.statusDialog("edit",e.row,e.$index)}}},[t._v("\n                    "+t._s(t.$t('m.slaContent["编辑"]'))+"\n                ")]),t._v(" "),e.row.is_builtin?[s("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:t.$t("m.slaContent['内置状态不可删除']"),expression:"$t(`m.slaContent['内置状态不可删除']`)",modifiers:{top:!0}}],staticClass:"bk-label-disabled"},[t._v("\n                        "+t._s(t.$t('m.slaContent["删除"]'))+"\n                    ")])]:[s("bk-button",{attrs:{theme:"primary",text:""},on:{click:function(s){return t.deleteDialog(e.row)}}},[t._v("\n                        "+t._s(t.$t('m.slaContent["删除"]'))+"\n                    ")])]]}}])})],1),t._v(" "),s("div",{staticClass:"mt20"},[s("bk-button",{staticClass:"mr10",attrs:{theme:"default",title:t.$t("m.deployPage['取消']"),disabled:t.secondClick},on:{click:t.backButton}},[t._v("\n            "+t._s(t.$t('m.deployPage["取消"]'))+"\n        ")]),t._v(" "),s("bk-button",{attrs:{theme:"primary",title:t.$t("m.deployPage['保存并下一步']"),loading:t.secondClick},on:{click:t.stepNext}},[t._v("\n            "+t._s(t.$t("m.deployPage['保存并下一步']"))+"\n        ")])],1),t._v(" "),s("bk-dialog",{attrs:{"render-directive":"if",width:t.addStatusDialog.width,"header-position":t.addStatusDialog.headerPosition,loading:t.secondClick,"auto-close":t.addStatusDialog.autoClose,"mask-close":t.addStatusDialog.autoClose,title:t.addStatusDialog.title},on:{confirm:t.confirmFn,cancel:t.cancelFn},model:{value:t.addStatusDialog.isShow,callback:function(e){t.$set(t.addStatusDialog,"isShow",e)},expression:"addStatusDialog.isShow"}},[s("bk-form",{ref:"addStatus",attrs:{"label-width":200,"form-type":"vertical",model:t.addTemp,rules:t.rules}},[s("bk-form-item",{attrs:{label:t.$t("m.slaContent['状态名称']"),required:!0,property:"name"}},[s("bk-input",{attrs:{maxlength:"120",placeholder:t.$t("m.slaContent['状态名称']")},model:{value:t.addTemp.name,callback:function(e){t.$set(t.addTemp,"name",e)},expression:"addTemp.name"}})],1),t._v(" "),s("bk-form-item",{attrs:{desc:t.colorTips,label:t.$t("m.slaContent['状态颜色']"),property:"color_hex",required:!0}},[s("div",{directives:[{name:"bk-clickoutside",rawName:"v-bk-clickoutside",value:t.closePickers,expression:"closePickers"}],on:{click:t.showPickers}},[s("bk-input",{attrs:{placeholder:t.$t("m.slaContent['请选择颜色']")},model:{value:t.addTemp.color_hex,callback:function(e){t.$set(t.addTemp,"color_hex",e)},expression:"addTemp.color_hex"}},[s("template",{slot:"prepend"},[s("div",{staticClass:"color-pick-color",style:{backgroundColor:t.addTemp.color_hex||"#3A84FF"}})])],2),t._v(" "),s("transition",[t.showColorPicker?s("div",{staticClass:"sla-colors-div"},t._l(t.statusColors,(function(e){return s("span",{staticClass:"sla-colors-span",style:{backgroundColor:e.color},attrs:{title:e.name},on:{click:function(s){return t.changeColor(e)}}})})),0):t._e()])],1)]),t._v(" "),s("bk-form-item",{attrs:{label:t.$t("m.slaContent['状态说明']")}},[s("bk-input",{attrs:{placeholder:t.$t("m.slaContent['请输入状态说明']"),type:"textarea",rows:3,maxlength:100},model:{value:t.addTemp.desc,callback:function(e){t.$set(t.addTemp,"desc",e)},expression:"addTemp.desc"}})],1)],1)],1)],1)},a=[];i._withStripped=!0},JSnN:function(t,e,s){"use strict";s.r(e);var i=s("IJ+s"),a=s("tuLe");for(var n in a)["default"].indexOf(n)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(n);s("q39q");var o=s("KHd+"),r=Object(o.a)(a.default,i.a,i.b,!1,null,"340f39ab",null);r.options.__file="src/views/slaManager/ticketStatus/firstStep.vue",e.default=r.exports},OmKX:function(t,e,s){},SBpE:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r(s("14Xm")),a=r(s("D3Ub")),n=s("CeR/"),o=r(s("PaSM"));function r(t){return t&&t.__esModule?t:{default:t}}e.default={name:"secondStep",mixins:[o.default],props:{statusType:{type:String,default:""}},data:function(){return{versionStatus:!0,secondClick:!1,isDataLoading:!1,trueStatus:!0,falseStatus:!1,autoConfigDialog:{isShow:!1,hasHeader:!0,width:700,headerPosition:"left",autoClose:!1},timeList:[{id:"m",name:this.$t("m.slaContent['分钟']")},{id:"h",name:this.$t("m.slaContent['小时']")},{id:"d",name:this.$t("m.slaContent['天']")}],isAutoTemp:{item:{},info:{threshold:null,id:"",timeSpace:"d"}},statusOwnList:[],dataList:[],flowList:[],isDropdownShow:!1,rules:{}}},mounted:function(){var t=this;return(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getTypeStatus();case 2:return e.next=4,t.listAddFlow();case 4:t.dataList=t.dataList.filter((function(t){return!t.is_over})),t.dataList.forEach((function(e){t.$set(e,"checkBoxStatus",{}),t.statusOwnList.forEach((function(t){e.checkBoxStatus[t.key]=-1!==e.can_flow_to.indexOf(t.id)}))})),t.rules.threshold=t.checkCommonRules("select").select,t.rules.id=t.checkCommonRules("select").select;case 8:case"end":return e.stop()}}),e,t)})))()},methods:{backButton:function(){this.$parent.backTab()},ajaxSubmit:function(){for(var t=this,e={name:"启动",service_type:this.statusType,batch_create:!0,rules:[]},s=0;s<2;s++)e.rules.push({condition_type:"STOP",condition:{type:"any",expressions:[]}});e.rules[1].condition_type="PAUSE",this.secondClick||(this.secondClick=!0,this.$store.dispatch("ticketStatus/endSubmitFlow",e).then((function(e){t.$bkMessage({message:"保存成功",theme:"success"}),t.$parent.backTab()})).catch((function(e){t.$bkMessage({message:e.data.msg,theme:"error"})})).finally((function(){t.secondClick=!1})))},nameFilter:function(t){return this.$t("m.slaContent['从']")+"【"+t+"】"+this.$t("m.slaContent['可以流转至']")},getTypeStatus:function(){var t=this;return(0,a.default)(i.default.mark((function e(){var s;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isDataLoading=!0,s={},e.next=4,t.$store.dispatch("ticketStatus/getTypeStatus",{type:t.statusType,params:s}).then((function(e){t.statusOwnList=e.data,t.dataList=e.data})).catch((function(e){(0,n.errorHandler)(e,t)})).finally((function(){}));case 4:case"end":return e.stop()}}),e,t)})))()},initIsAutoTemp:function(){this.isAutoTemp.info.threshold=null,this.isAutoTemp.info.id="",this.isAutoTemp.info.timeSpace="d"},listAddFlow:function(){var t=this;return(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isDataLoading=!0,t.dataList.forEach((function(e){t.$set(e,"can_flow_to",[]),t.$set(e,"is_auto",!1)})),e.next=4,t.$store.dispatch("ticketStatus/getTypeFlow",t.statusType).then((function(e){e.data.forEach((function(e){for(var s=0;s<t.dataList.length;s++)if(t.dataList[s].id===e.from_status)return void t.dataList[s].can_flow_to.push(e.to_status)}))})).catch((function(e){(0,n.errorHandler)(e,t)})).finally((function(){}));case 4:return e.next=6,t.$store.dispatch("ticketStatus/getTypeAutoFlow",t.statusType).then((function(e){var s=e.data;for(var i in s)for(var a=0;a<t.dataList.length;a++)t.dataList[a].id===Number(i)&&(t.dataList[a].is_auto=s[i])})).catch((function(e){(0,n.errorHandler)(e,t)})).finally((function(){t.isDataLoading=!1}));case 6:case"end":return e.stop()}}),e,t)})))()},selectFlowTo:function(t,e){var s=t.can_flow_to.indexOf(e.id);-1!==s?t.can_flow_to.splice(s,1):t.can_flow_to.push(e.id)},previousStep:function(){this.$parent.changeTree(1,"back")},stepNext:function(){var t=this;return(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.saveTypeFlow();case 2:t.$parent.changeTree(1,"next");case 3:case"end":return e.stop()}}),e,t)})))()},saveTypeFlow:function(){var t=this;return(0,a.default)(i.default.mark((function e(){var s,a,o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=[],a=t.statusType,t.dataList.forEach((function(t){t.can_flow_to.forEach((function(e){var i={from_status:t.id,to_status:e};s.push(i)}))})),o={service_type:a,transits:s},e.next=6,t.$store.dispatch("ticketStatus/saveTypeFlow",o).then((function(t){})).catch((function(e){(0,n.errorHandler)(e,t)})).finally((function(){}));case 6:case"end":return e.stop()}}),e,t)})))()},isAutoChange:function(t){var e=this;this.saveTypeFlow(),t.is_auto?this.$bkInfo({type:"warning",title:this.$t('m.slaContent["确认取消？"]'),subTitle:this.$t('m.slaContent["确认后，将取消自动流转！"]'),confirmFn:function(){var s=t.id;e.secondClick||(e.secondClick=!0,e.$store.dispatch("ticketStatus/closeAutoFlow",s).then((function(t){e.$bkMessage({message:e.$t('m.manageCommon["取消成功"]'),theme:"success"}),e.listAddFlow()})).catch((function(t){(0,n.errorHandler)(t,e)})).finally((function(){e.secondClick=!1})))}}):(this.getFlowList(t),this.isAutoTemp.item=t,this.autoConfigDialog.isShow=!0)},editRule:function(t){var e=this;return(0,a.default)(i.default.mark((function s(){var a;return i.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return e.saveTypeFlow(),e.getFlowList(t),a=t.id,s.next=5,e.$store.dispatch("ticketStatus/getOneAutoFlow",a).then((function(s){e.isAutoTemp.item=t,e.isAutoTemp.info.threshold=s.data.threshold,e.isAutoTemp.info.timeSpace=s.data.threshold_unit,e.isAutoTemp.info.id=s.data.to_status})).catch((function(t){(0,n.errorHandler)(t,e)})).finally((function(){}));case 5:e.isAutoTemp.item=t,e.autoConfigDialog.isShow=!0;case 7:case"end":return s.stop()}}),s,e)})))()},getFlowList:function(t){var e=this;this.flowList=[],t.can_flow_to.forEach((function(t){for(var s={name:"",id:t},i=0;i<e.statusOwnList.length;i++)e.statusOwnList[i].id===t&&(s.name=e.statusOwnList[i].name);e.flowList.push(s)}))},confirmFn:function(){var t=this;this.$refs.autoForm.validate().then((function(e){t.ajaxConfirmFn()}),(function(t){console.warn(t)}))},ajaxConfirmFn:function(){var t=this,e={to_status:this.isAutoTemp.info.id,threshold:this.isAutoTemp.info.threshold,threshold_unit:this.isAutoTemp.info.timeSpace},s=this.isAutoTemp.item.id;this.$store.dispatch("ticketStatus/setAutoFlow",{params:e,id:s}).then((function(e){t.$bkMessage({message:"操作成功",theme:"success"})})).catch((function(e){(0,n.errorHandler)(e,t)})).finally((function(){t.autoConfigDialog.isShow=!1,t.isAutoTemp.item.is_auto=!0,t.listAddFlow(),t.initIsAutoTemp()}))},cancelFn:function(){this.autoConfigDialog.isShow=!1,this.initIsAutoTemp()},closeVersion:function(){this.versionStatus=!1},dropdownShow:function(){this.isDropdownShow=!0},dropdownHide:function(){this.isDropdownShow=!1},timeHandler:function(t){this.$refs.dropdown.hide(),this.isAutoTemp.info.timeSpace=t.id}}}},cRZQ:function(t,e,s){},"iYK/":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=l(s("gDS+")),a=l(s("14Xm")),n=l(s("D3Ub")),o=s("CeR/"),r=l(s("PaSM"));function l(t){return t&&t.__esModule?t:{default:t}}e.default={name:"firstStep",mixins:[r.default],props:{statusType:{type:String,default:""}},data:function(){return{trueStatus:!0,falseStatus:!1,secondClick:!1,isDataLoading:!1,statusTable:[],addStatusDialog:{isAdd:!0,isShow:!1,title:"",width:700,headerPosition:"left",autoClose:!1,precision:0},addTemp:{name:"",desc:"",color_hex:"#3A84FF"},isEdit:{flag:!1,index:null,id:null},statusColors:[{name:"ITSM blue",color:"#3A84FF"},{name:"UA blue",color:"#0033CC"},{name:"Moderate blue",color:"#428BCA"},{name:"lime green",color:"#44AD8E"},{name:"feijoa",color:"#A8D695"},{name:"Slightly desaturate green",color:"#5CB85C"},{name:"bright green",color:"#69D100"},{name:"Very dark lime green",color:"#004E00"},{name:"Very dark desaturate blue",color:"#34495E"},{name:"Slightly cyan",color:"#A4AAB3"},{name:"Dark grayish cyan",color:"#7F8C8D"},{name:"Slight desaturate blue",color:"#A295D6"},{name:"Dark moderate blue",color:"#5843AD"},{name:"Dark moderate violet",color:"#8E44AD"},{name:"Very pale orange",color:"#FFECDB"},{name:"Dark moderate pink",color:"#AD4363"},{name:"Strong pink",color:"#D10069"},{name:"Strong red",color:"#CC0033"},{name:"Light red",color:"#FF5656"},{name:"Pure red",color:"#FF0000"},{name:"Soft red",color:"#D9534F"},{name:"Strong yellow",color:"#D1D100"},{name:"Soft orange",color:"#F0AD4E"},{name:"Dark moderate orange",color:"#AD8D43"}],colorTips:{width:130,content:this.$t('m.slaContent["选择颜色后，当单据流转到该状态时，单据状态栏信息会更新为对应颜色。多个状态的颜色可以重复。"]'),placement:"top"},showColorPicker:!1,rules:{}}},mounted:function(){var t=this;return(0,n.default)(a.default.mark((function e(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getTypeStatus();case 2:t.rules.name=t.checkCommonRules("name").name,t.rules.desc=t.checkCommonRules("select").select,t.rules.color_hex=t.checkCommonRules("color").color;case 5:case"end":return e.stop()}}),e,t)})))()},methods:{changeColor:function(t){this.addTemp.color_hex=t.color},showPickers:function(){this.showColorPicker=!0},closePickers:function(){this.showColorPicker=!1},selectOrigin:function(t){this.statusTable.forEach((function(t){t.is_start=!1})),t.is_start=!t.is_start},selectFinish:function(t){t.is_over=!t.is_over},initAddTemp:function(){this.addTemp={name:"",desc:"",color_hex:"#3A84FF"}},statusDialog:function(t,e,s){this.secondClick||(this.secondClick=!0,"add"===t?(this.addStatusDialog.title=this.$t('m.slaContent["新增状态"]'),this.addStatusDialog.isShow=!0,this.addTemp.color_hex="#3A84FF"):(this.addStatusDialog.title=this.$t('m.slaContent["编辑状态"]'),this.isEdit.flag=!0,this.isEdit.index=s,this.isEdit.id=e.id,this.addTemp=JSON.parse((0,i.default)(e)),this.addStatusDialog.isShow=!0),this.secondClick=!1)},cancelFn:function(){this.showColorPicker=!1,this.isEdit.flag=!1,this.initAddTemp(),this.addStatusDialog.isShow=!1},confirmFn:function(){var t=this;this.$refs.addStatus.validate().then((function(e){t.secondClick=!0;var s={name:t.addTemp.name,desc:t.addTemp.desc,color_hex:t.addTemp.color_hex},i={};if(t.isEdit.flag){var a=t.isEdit.id;t.$store.dispatch("ticketStatus/editTypeState",{params:s,id:a}).then((function(e){i=e.data,t.$bkMessage({message:"编辑成功",theme:"success"})})).catch((function(e){(0,o.errorHandler)(e,t)})).finally((function(){t.statusTable[t.isEdit.index].name=i.name,t.statusTable[t.isEdit.index].desc=i.desc,t.secondClick=!1,t.showColorPicker=!1,t.initAddTemp(),t.isEdit.flag=!1,t.addStatusDialog.isShow=!1,t.getTypeStatus()}))}else s.service_type=t.statusType,t.$store.dispatch("ticketStatus/addTypeState",s).then((function(e){i=e.data,t.$bkMessage({message:t.$t('m.serviceConfig["添加成功"]'),theme:"success"})})).catch((function(e){(0,o.errorHandler)(e,t)})).finally((function(){t.statusTable.push(i),t.secondClick=!1,t.showColorPicker=!1,t.initAddTemp(),t.isEdit.flag=!1,t.addStatusDialog.isShow=!1,t.getTypeStatus()}))}),(function(t){console.warn(t)}))},deleteDialog:function(t){var e=this;this.$bkInfo({type:"warning",title:this.$t('m.slaContent["确认删除？"]'),confirmFn:function(){var s=t.id;e.secondClick||(e.secondClick=!0,e.$store.dispatch("ticketStatus/deleteTypeState",s).then((function(t){e.$bkMessage({message:e.$t('m.systemConfig["删除成功"]'),theme:"success"}),e.getTypeStatus()})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.secondClick=!1})))}})},backButton:function(){this.$parent.backTab()},stepNext:function(){var t=this;return(0,n.default)(a.default.mark((function e(){var s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.secondClick){e.next=2;break}return e.abrupt("return");case 2:return t.secondClick=!0,s={service_type:t.statusType,ticket_status_ids:[],start_status_id:null,over_status_ids:[]},t.statusTable.forEach((function(t){s.ticket_status_ids.push(t.id),t.is_start&&(s.start_status_id=t.id),t.is_over&&s.over_status_ids.push(t.id)})),e.next=7,t.$store.dispatch("ticketStatus/saveTypeState",s).then((function(e){t.$bkMessage({message:t.$t('m.newCommon["保存成功"]'),theme:"success"})})).catch((function(e){(0,o.errorHandler)(e,t)})).finally((function(){t.secondClick=!1,t.getTypeStatus()}));case 7:t.$parent.changeTree(0,"next");case 8:case"end":return e.stop()}}),e,t)})))()},getTypeStatus:function(){var t=this;return(0,n.default)(a.default.mark((function e(){var s;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isDataLoading=!0,s={},e.next=4,t.$store.dispatch("ticketStatus/getTypeStatus",{type:t.statusType,params:s}).then((function(e){t.statusTable=e.data})).catch((function(e){(0,o.errorHandler)(e,t)})).finally((function(){t.isDataLoading=!1}));case 4:case"end":return e.stop()}}),e,t)})))()}}}},jMy6:function(t,e,s){"use strict";s.r(e);var i=s("wUhB"),a=s("//gz");for(var n in a)["default"].indexOf(n)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(n);s("Dg4g");var o=s("KHd+"),r=Object(o.a)(a.default,i.a,i.b,!1,null,"0a191761",null);r.options.__file="src/views/slaManager/ticketStatus/secondStep.vue",e.default=r.exports},l1Uy:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("CeR/"),a=r(s("JSnN")),n=r(s("jMy6")),o=r(s("0hVY"));function r(t){return t&&t.__esModule?t:{default:t}}e.default={name:"ticketStatus",components:{firstStep:a.default,secondStep:n.default},mixins:[o.default],data:function(){return{isDataLoading:!1,business:!1,dataList:[],processStatus:{addNew:!1},versionStatus:!0,lineList:[{id:1,name:this.$t('m.slaContent["单据状态"]'),type:"primary",show:!0},{id:2,name:this.$t('m.slaContent["流转设置"]'),type:"normal",show:!1}],editInfo:{itemInfo:{},newNode:!1},treeTag:"",statusType:"",tagName:""}},computed:{sliderStatus:function(){return this.$store.state.common.slideStatus}},mounted:function(){this.getTypeStatusList()},methods:{getTypeStatusList:function(){var t=this;this.isDataLoading=!0,this.$store.dispatch("ticketStatus/getFourTypesList").then((function(e){t.dataList=e.data;var s=t.dataList.findIndex((function(t){return 3===t.id}));t.dataList.splice(s,1)})).catch((function(e){(0,i.errorHandler)(e,t)})).finally((function(){t.isDataLoading=!1}))},editStatus:function(t){this.hasPermission(["ticket_state_manage"],this.$store.state.project.projectAuthActions)?(this.tagName=t.service_type_name,this.statusType=t.service_type,this.editInfo.itemInfo=t,this.editInfo.newNode=t.id,this.processStatus.addNew=!this.processStatus.addNew,this.changeTree(0,"first")):this.applyForPermission(["ticket_state_manage"],this.$store.state.project.projectAuthActions,{})},configStatus:function(t){this.hasPermission(["ticket_state_manage"],this.$store.state.project.projectAuthActions)?(this.tagName=t.service_type_name,this.statusType=t.service_type,this.editInfo.itemInfo={},this.editInfo.newNode=null,this.processStatus.addNew=!this.processStatus.addNew,this.changeTree(0,"first")):this.applyForPermission(["ticket_state_manage"],this.$store.state.project.projectAuthActions,{})},trClick:function(t){t.configured?this.editStatus(t):this.configStatus(t)},changeTree:function(t,e){if(this.editInfo.itemInfo.id){if("first"===e){for(var s=0;s<this.lineList.length;s++)this.lineList[s].show=!1,this.lineList[s].type="success";this.lineList[0].show=!0,this.lineList[0].type="primary"}if("next"===e&&(this.lineList[t].type="success",this.lineList[t].show=!1,this.lineList[t+1].type="primary",this.lineList[t+1].show="true"),"back"===e&&(this.lineList[t].type="success",this.lineList[t].show=!1,this.lineList[t-1].type="primary",this.lineList[t-1].show="true"),"change"===e){for(var i=0;i<this.lineList.length;i++)this.lineList[i].show=!1,this.lineList[i].type="success";this.lineList[t].type="primary",this.lineList[t].show=!0}}else{if("first"===e){for(var a=0;a<this.lineList.length;a++)this.lineList[a].show=!1,this.lineList[a].type="normal";this.lineList[0].show=!0,this.lineList[0].type="primary"}if("next"===e&&(this.lineList[t].type="success",this.lineList[t].show=!1,this.lineList[t+1].type="primary",this.lineList[t+1].show="true"),"back"===e&&(this.lineList[t].type="normal",this.lineList[t].show=!1,this.lineList[t-1].type="primary",this.lineList[t-1].show="true"),"change"===e){if("normal"===this.lineList[t].type)return;var n=this.lineList.findIndex((function(t){return t.show}));this.lineList[n].show=!1,this.lineList[n].type="normal",this.lineList[t].type="primary",this.lineList[t].show=!0}}},backTab:function(){this.statusType="",this.editInfo.itemInfo={},this.editInfo.newNode=null,this.processStatus.addNew=!this.processStatus.addNew,this.changeTree(0,"first"),this.getTypeStatusList()},closeVersion:function(){this.versionStatus=!1}}}},q39q:function(t,e,s){"use strict";s("cRZQ")},tUm2:function(t,e,s){"use strict";s("4oWx")},tuLe:function(t,e,s){"use strict";s.r(e);var i=s("iYK/"),a=s.n(i);for(var n in i)["default"].indexOf(n)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(n);e.default=a.a},wK6c:function(t,e,s){"use strict";s.d(e,"a",(function(){return i})),s.d(e,"b",(function(){return a}));var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"bk-itsm-box"},[t.processStatus.addNew?[s("div",{staticClass:"is-title",class:{"bk-title-left":!t.sliderStatus}},[s("p",{staticClass:"bk-come-back",on:{click:t.backTab}},[s("arrows-left-icon"),t._v("\n                "+t._s(t.tagName)+"\n            ")],1)]),t._v(" "),s("div",{staticClass:"bk-itsm-tree"},[s("div",{staticClass:"bk-tree-content"},t._l(t.lineList,(function(e,i){return s("div",{key:e.id,staticClass:"bk-tree-first"},[s("div",{staticClass:"bk-tree-shadow",on:{click:function(s){return t.changeTree(i,"change",e)}}},[s("span",{staticClass:"bk-tree-step",class:{"bk-tree-primary":"primary"===e.type,"bk-tree-success":"success"===e.type,"bk-tree-error":"error"===e.type}},["success"===e.type?s("i",{staticClass:"bk-icon icon-check-1"}):t._e(),t._v(" "),"error"===e.type?s("i",{staticClass:"bk-icon icon-close",staticStyle:{"font-size":"18px"}}):t._e(),t._v(" "),"success"!==e.type&&"error"!==e.type?s("span",[t._v(t._s(e.id))]):t._e()]),t._v(" "),s("span",{staticClass:"bk-tree-normal bk-tree-cursor",class:{"bk-tree-info":e.show||"normal"!==e.type}},[t._v(t._s(e.name))])]),t._v(" "),e.id!==t.lineList.length?s("span",{staticClass:"bk-tree-line"}):t._e()])})),0)]),t._v(" "),s("div",{staticClass:"bk-design-step"},[t.lineList[0].show?s("first-step",{ref:"first",attrs:{"status-type":t.statusType}}):t._e(),t._v(" "),t.lineList[1].show?s("second-step",{ref:"second",attrs:{"status-type":t.statusType}}):t._e()],1)]:s("div",{staticClass:"bk-itsm-service"},[s("div",{staticClass:"is-title",class:{"bk-title-left":!t.sliderStatus}},[s("p",{staticClass:"bk-come-back"},[t._v("\n                "+t._s(t.$t('m.slaContent["单据状态管理"]'))+"\n            ")])]),t._v(" "),s("div",{staticClass:"itsm-page-content"},[t.versionStatus?s("div",{staticClass:"bk-itsm-version"},[s("i",{staticClass:"bk-icon icon-info-circle"}),t._v(" "),s("span",[t._v(t._s(t.$t('m.slaContent["单据状态：可根据需要，针对不同服务类型，定义及管理相应的单据状态、以及状态间的流转逻辑。单据状态的更新及变化，会体现在每一个具体的服务单据流转过程中。"]')))]),t._v(" "),s("i",{staticClass:"bk-icon icon-close",on:{click:t.closeVersion}})]):t._e(),t._v(" "),s("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isDataLoading},expression:"{ isLoading: isDataLoading }"}],attrs:{data:t.dataList,size:"small"}},[s("bk-table-column",{attrs:{label:t.$t("m.slaContent['服务类型']"),width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.hasPermission(["ticket_state_manage"])},expression:"{ active: !hasPermission(['ticket_state_manage']) }"}],class:["bk-lable-primary",{"btn-permission-disable":!t.hasPermission(["ticket_state_manage"])}],attrs:{title:e.row.service_type_name},on:{click:function(s){return t.trClick(e.row)}}},[t._v("\n                            "+t._s(e.row.service_type_name||"--")+"\n                        ")])]}}],null,!1,1628831961)}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("m.slaContent['单据状态']")},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{attrs:{title:e.row.ticket_status}},[t._v(t._s(e.row.ticket_status||"--"))])]}}],null,!1,3868009774)}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("m.slaContent['更新时间']"),prop:"update_at"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{attrs:{title:e.row.update_at}},[t._v(t._s(e.row.update_at||"--"))])]}}],null,!1,401090478)}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("m.slaContent['更新人']"),width:"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{attrs:{title:e.row.updated_by}},[t._v(t._s(e.row.updated_by||"--"))])]}}],null,!1,881672334)}),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("m.slaContent['操作']"),width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.configured?s("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.hasPermission(["ticket_state_manage"])},expression:"{ active: !hasPermission(['ticket_state_manage']) }"}],class:{"text-permission-disable":!t.hasPermission(["ticket_state_manage"])},attrs:{theme:"primary",text:""},on:{click:function(s){return t.editStatus(e.row)}}},[t._v("\n                            "+t._s(t.$t('m.slaContent["编辑"]'))+"\n                        ")]):s("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.hasPermission(["ticket_state_manage"])},expression:"{ active: !hasPermission(['ticket_state_manage']) }"}],class:{"text-permission-disable":!t.hasPermission(["ticket_state_manage"])},attrs:{theme:"primary",icon:"icon-exclamation-circle",text:""},on:{click:function(s){return t.configStatus(e.row)}}},[t._v("\n                            "+t._s(t.$t('m.slaContent["未配置"]'))+"\n                        ")])]}}],null,!1,3026838606)})],1)],1)])],2)},a=[];i._withStripped=!0},wUhB:function(t,e,s){"use strict";s.d(e,"a",(function(){return i})),s.d(e,"b",(function(){return a}));var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"secondStep"},[t.versionStatus?s("div",{staticClass:"bk-itsm-version",staticStyle:{margin:"0 0 10px 0"}},[s("i",{staticClass:"bk-icon icon-info-circle"}),t._v(" "),s("span",[t._v(t._s(t.$t("m.slaContent['流转设定，是设置工作状态间的先后流转关系。如果需要设置该流转，请在两个状态间的复选框内打勾。结束状态（如已完成，被终止，被撤销）无法逆向流转。']")))]),t._v(" "),s("i",{staticClass:"bk-icon icon-close",on:{click:t.closeVersion}})]):t._e(),t._v(" "),s("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isDataLoading},expression:"{ isLoading: isDataLoading }"}],attrs:{data:t.dataList,size:"small"}},[s("bk-table-column",{attrs:{label:t.$t("m.slaContent['状态名']"),"min-width":150},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{attrs:{title:t.nameFilter(e.row.name)}},[t._v(t._s(t.nameFilter(e.row.name)))])]}}])}),t._v(" "),t._l(t.statusOwnList,(function(e){return[s("bk-table-column",{key:e.id,attrs:{label:e.name},scopedSlots:t._u([{key:"default",fn:function(i){return[i.row.checkBoxStatus?[s("bk-checkbox",{staticClass:"bk-outline-none",attrs:{"true-value":t.trueStatus,"false-value":t.falseStatus},on:{change:function(s){return t.selectFlowTo(i.row,e)}},model:{value:i.row.checkBoxStatus[e.key],callback:function(s){t.$set(i.row.checkBoxStatus,e.key,s)},expression:"props.row.checkBoxStatus[item.key]"}})]:t._e()]}}],null,!0)})]})),t._v(" "),s("bk-table-column",{attrs:{label:t.$t("m.slaContent['开启自动流转']")},scopedSlots:t._u([{key:"default",fn:function(e){return[s("bk-checkbox",{staticClass:"bk-outline-none",attrs:{"true-value":t.trueStatus,"false-value":t.falseStatus},model:{value:e.row.is_auto,callback:function(s){t.$set(e.row,"is_auto",s)},expression:"props.row.is_auto"}}),t._v(" "),s("div",{staticClass:"bk-outline-mont",on:{click:function(s){return t.isAutoChange(e.row)}}}),t._v(" "),e.row.is_auto?s("i",{staticClass:"bk-itsm-icon icon-edit-new flow-icon",on:{click:function(s){return s.stopPropagation(),t.editRule(e.row)}}}):t._e()]}}])})],2),t._v(" "),s("div",{staticClass:"mt20"},[s("bk-button",{staticClass:"mr10",attrs:{theme:"default",title:t.$t("m.slaContent['上一步']"),disabled:t.secondClick},on:{click:t.previousStep}},[t._v("\n            "+t._s(t.$t('m.slaContent["上一步"]'))+"\n        ")]),t._v(" "),s("bk-button",{staticClass:"mr10",attrs:{theme:"default",title:t.$t("m.deployPage['取消']"),disabled:t.secondClick},on:{click:t.backButton}},[t._v("\n            "+t._s(t.$t('m.deployPage["取消"]'))+"\n        ")]),t._v(" "),s("bk-button",{attrs:{theme:"primary",title:t.$t("m.slaContent['提交']"),loading:t.secondClick},on:{click:t.ajaxSubmit}},[t._v("\n            "+t._s(t.$t("m.slaContent['提交']"))+"\n        ")])],1),t._v(" "),s("bk-dialog",{attrs:{"render-directive":"if",width:t.autoConfigDialog.width,"header-position":t.autoConfigDialog.headerPosition,"auto-close":t.autoConfigDialog.autoClose,"mask-close":t.autoConfigDialog.autoClose},on:{confirm:t.confirmFn,cancel:t.cancelFn},model:{value:t.autoConfigDialog.isShow,callback:function(e){t.$set(t.autoConfigDialog,"isShow",e)},expression:"autoConfigDialog.isShow"}},[s("p",{attrs:{slot:"header"},slot:"header"},[t._v("\n            "+t._s(t.$t("m.slaContent['自动流转设置']"))+"\n        ")]),t._v(" "),s("div",{staticClass:"bk-auto-conten"},[s("bk-form",{ref:"autoForm",attrs:{"label-width":200,"form-type":"vertical",model:t.isAutoTemp.info,rules:t.rules}},[s("p",{staticClass:"bk-auto-p"},[t._v("\n                    "+t._s(t.$t("m.slaContent['单据在']"))+"【"+t._s(t.isAutoTemp.item.name)+"】"+t._s(t.$t("m.slaContent['停留时间超过']"))+"\n                ")]),t._v(" "),s("bk-form-item",{staticClass:"bk-auto-time",attrs:{property:"threshold","icon-offset":75}},[s("bk-input",{attrs:{"font-size":"normal",type:"number",min:0},model:{value:t.isAutoTemp.info.threshold,callback:function(e){t.$set(t.isAutoTemp.info,"threshold",e)},expression:"isAutoTemp.info.threshold"}},[s("bk-dropdown-menu",{ref:"dropdown",staticClass:"group-text",attrs:{slot:"append","font-size":"normal"},on:{show:t.dropdownShow,hide:t.dropdownHide},slot:"append"},[s("bk-button",{attrs:{slot:"dropdown-trigger",type:"primary"},slot:"dropdown-trigger"},[t._l(t.timeList,(function(e,i){return s("span",{key:i},[t.isAutoTemp.info.timeSpace===e.id?[t._v(t._s(e.name))]:t._e()],2)})),t._v(" "),s("i",{class:["bk-icon icon-angle-down",{"icon-flip":t.isDropdownShow}]})],2),t._v(" "),s("ul",{staticClass:"bk-dropdown-list",attrs:{slot:"dropdown-content"},slot:"dropdown-content"},t._l(t.timeList,(function(e,i){return s("li",{key:i},[s("a",{attrs:{href:"javascript:;"},on:{click:function(s){return t.timeHandler(e)}}},[t._v(t._s(e.name))])])})),0)],1)],1)],1),t._v(" "),s("p",{staticClass:"bk-auto-p"},[t._v(t._s(t.$t("m.slaContent['时，将自动流转至']")))]),t._v(" "),s("bk-form-item",{staticClass:"bk-auto-select",staticStyle:{width:"100px"},attrs:{property:"id"}},[s("bk-select",{attrs:{searchable:"","font-size":"medium",clearable:t.falseStatus},model:{value:t.isAutoTemp.info.id,callback:function(e){t.$set(t.isAutoTemp.info,"id",e)},expression:"isAutoTemp.info.id"}},t._l(t.flowList,(function(t){return s("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})})),1)],1)],1)],1)])],1)},a=[];i._withStripped=!0},x9rO:function(t,e,s){"use strict";s.r(e);var i=s("l1Uy"),a=s.n(i);for(var n in i)["default"].indexOf(n)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(n);e.default=a.a}}]);