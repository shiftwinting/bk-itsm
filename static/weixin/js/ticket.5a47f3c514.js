(window.webpackJsonp=window.webpackJsonp||[]).push([[4],Array(88).concat([function(e,t,c){"use strict";var a=c(0);const l={key:0,class:"not-support required"},n={class:"van-ellipsis"},s=Object(a.i)("div",{class:"content-right text-status"}," 请选择 ",-1),i={key:1,class:"common-view-field"},o={class:"view-label"},r=Object(a.i)("span",{class:"view-value",style:{color:"#e5e6e9"}},"暂不支持显示",-1);var u=c(307),d=Object(a.l)({name:"NotSupport",props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},setup:()=>({handelNotSupportPrompt:()=>{Object(u.a)({message:"暂不支持操作，请至PC端处理",className:"not-support-toast"})}})}),b=(c(214),c(30));const O=c.n(b)()(d,[["render",function(e,t,c,u,d,b){const O=Object(a.J)("van-icon");return e.isViewMode?(Object(a.C)(),Object(a.h)("p",i,[Object(a.i)("label",o,Object(a.N)(e.item.name),1),r])):(Object(a.C)(),Object(a.h)("div",l,[Object(a.i)("span",n,[Object(a.j)(Object(a.N)(e.item.name)+" ",1),Object(a.k)(O,{name:"info-o",color:"#ffb213",onClick:e.handelNotSupportPrompt},null,8,["onClick"])]),s]))}]]);t.a=O},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,c){},function(e,t,c){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},,function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},function(e,t,c){},,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,c){"use strict";c(132)},function(e,t,c){"use strict";c(133)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,c){var a={"./checkbox.vue":291,"./custom-form.vue":289,"./date.vue":292,"./datetime.vue":293,"./file.vue":294,"./inputselect.vue":295,"./int.vue":296,"./link.vue":290,"./member.vue":297,"./members.vue":298,"./multiselect.vue":299,"./radio.vue":300,"./richtext.vue":301,"./select.vue":302,"./string.vue":303,"./table.vue":304,"./text.vue":305,"./tree.vue":306};function l(e){var t=n(e);return c(t)}function n(e){if(!c.o(a,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return a[e]}l.keys=function(){return Object.keys(a)},l.resolve=n,e.exports=l,l.id=260},function(e,t,c){"use strict";c(164)},function(e,t,c){"use strict";c(165)},function(e,t,c){"use strict";c(166)},function(e,t,c){"use strict";c(167)},function(e,t,c){"use strict";c(168)},function(e,t,c){"use strict";c(169)},function(e,t,c){"use strict";c(171)},function(e,t,c){"use strict";c(172)},function(e,t,c){"use strict";c(173)},function(e,t,c){"use strict";c(174)},function(e,t,c){"use strict";c(175)},function(e,t,c){"use strict";c(176)},function(e,t,c){"use strict";c(177)},function(e,t,c){"use strict";c(178)},function(e,t,c){"use strict";c(179)},function(e,t,c){"use strict";c(180)},function(e,t,c){"use strict";c(181)},,,,,function(e,t,c){"use strict";c(182)},function(e,t,c){"use strict";c(183)},function(e,t,c){"use strict";c(184)},function(e,t,c){"use strict";c(185)},function(e,t,c){"use strict";c(186)},function(e,t,c){"use strict";c(187)},function(e,t,c){"use strict";c(188)},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={class:"common-view-field",style:{display:"block"}},n={class:"view-label"};const s={class:"render-view"},i={key:0,class:"inner-render-view"},o={class:"inner-view-title"},r={class:"inner-render-view-content"};const u={class:"header-title"},d={class:"view-label"},b={class:"view-value"},O={key:1,class:"common-view-field"},j={class:"view-label"},p={class:"view-value"};var v={name:"ViewText",props:{form:{type:Object,default:()=>({})}},setup(e){const{form:t}=Object(a.O)(e);return{form:t}}},m=(c(262),c(30)),f=c.n(m);var h=f()(v,[["render",function(e,t,c,l,n,s){return l.form.children&&l.form.children.length?(Object(a.C)(),Object(a.h)(a.a,{key:0},[Object(a.i)("h4",u,Object(a.N)(l.form.label),1),(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(l.form.children,(e,t)=>(Object(a.C)(),Object(a.h)("p",{key:t,class:"common-view-field inner-text"},[Object(a.i)("label",d,Object(a.N)(e.label),1),Object(a.i)("span",b,Object(a.N)(e.value),1)]))),128))],64)):(Object(a.C)(),Object(a.h)("p",O,[Object(a.i)("label",j,Object(a.N)(l.form.label),1),Object(a.i)("span",p,Object(a.N)(l.form.value),1)]))}],["__scopeId","data-v-125354e8"]]);const k={class:"header-title"},y={class:"tag-table-wrap"},C={key:0,class:"tag-table table-fixed",cellspacing:"0",ellpadding:"0",border:"0"},g=["width"],w=(e=>(Object(a.F)("data-v-394961a2"),e=e(),Object(a.D)(),e))(()=>Object(a.i)("col",null,null,-1)),N={class:"table-cell"},_={class:"table-cell"},I={class:"base-table-body"},T={class:"tag-table",cellspacing:"0",cellpadding:"0",border:"0"},E=["width"],R={class:"table-cell"},S={class:"table-cell"};const D={key:0};var x={name:"TableText",props:{form:{type:Object,default:()=>({})}},setup(e){const{form:t}=Object(a.O)(e),c=Object(a.o)("innerFormInstance");return{form:t,onInnerLinkClick:()=>{if(!t.value.children||!t.value.children.length)return;let e=t.value.value;Array.isArray(t.value.value)&&(e=t.value.value.map(e=>e.label+e.value).join("")),c.pushToInnerForms({title:`${t.value.label||""}${e}`,formData:t.value.children})}}}};c(263);var V=f()(x,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("TableText",!0);return Object(a.C)(),Object(a.h)("p",{class:Object(a.t)(["table-text",{"has-children":l.form.children&&l.form.children.length}]),onClick:t[0]||(t[0]=(...e)=>l.onInnerLinkClick&&l.onInnerLinkClick(...e))},[Object(a.i)("label",null,Object(a.N)(l.form.label),1),Array.isArray(l.form.value)?(Object(a.C)(!0),Object(a.h)(a.a,{key:1},Object(a.I)(l.form.value,(e,t)=>(Object(a.C)(),Object(a.f)(i,{key:t,form:e},null,8,["form"]))),128)):(Object(a.C)(),Object(a.h)("span",D,Object(a.N)(l.form.value),1))],2)}]]),F=Object(a.l)({name:"ViewTable",components:{TableText:V},props:{form:{type:Object,default:()=>({})}},setup(e){const{form:t}=Object(a.O)(e);return{columns:Object(a.o)("context").schemes[t.value.scheme].attrs.column.map(e=>({...e,width:"140px"})),data:t.value.value,fixedFirstColumn:!1}}});c(264);var M=f()(F,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("TableText");return Object(a.C)(),Object(a.h)(a.a,null,[Object(a.i)("h4",k,Object(a.N)(e.form.label),1),Object(a.i)("div",y,[e.fixedFirstColumn?(Object(a.C)(),Object(a.h)("table",C,[Object(a.i)("colgroup",null,[Object(a.i)("col",{class:"frist-clo",width:e.columns[0].width},null,8,g),w]),Object(a.i)("thead",null,[Object(a.i)("tr",null,[Object(a.i)("th",null,[Object(a.i)("div",N,Object(a.N)(e.columns[0].name),1)])])]),Object(a.i)("tbody",null,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.data,(t,c)=>(Object(a.C)(),Object(a.h)("tr",{key:c},[Object(a.i)("td",null,[Object(a.i)("div",_,[Object(a.k)(i,{form:t[e.columns[0].key]},null,8,["form"])])])]))),128))])])):Object(a.g)("",!0),Object(a.i)("div",I,[Object(a.i)("table",T,[Object(a.i)("colgroup",null,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.columns,(e,t)=>(Object(a.C)(),Object(a.h)("col",{key:t,width:e.width},null,8,E))),128))]),Object(a.i)("thead",null,[Object(a.i)("tr",null,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.columns,(e,t)=>(Object(a.C)(),Object(a.h)("th",{key:t},[Object(a.i)("div",R,Object(a.N)(e.name),1)]))),128))])]),Object(a.i)("tbody",null,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.data,(t,c)=>(Object(a.C)(),Object(a.h)("tr",{key:c},[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.columns,(e,c)=>(Object(a.C)(),Object(a.h)("td",{key:c},[Object(a.i)("div",S,[Object(a.k)(i,{form:t[e.key]},null,8,["form"])])]))),128))]))),128))])])])])],64)}],["__scopeId","data-v-394961a2"]]),P=Object(a.l)({name:"RenderItem",components:{ViewText:h,ViewTable:M},props:{type:{type:String,default:""},form:{type:Object,default:()=>({})}},setup(e){const{type:t,form:c}=Object(a.O)(e);return{cType:"View"+t.value.replace(/^\w/,e=>e.toUpperCase()),form:c}}});var L=f()(P,[["render",function(e,t,c,l,n,s){return Object(a.C)(),Object(a.f)(Object(a.L)(e.cType),{form:e.form},null,8,["form"])}]]),H=Object(a.l)({name:"RenderView",components:{RenderItem:L},props:{formData:{type:Array,default:()=>[]},context:{type:Object,default:()=>({})}},setup(e){const{formData:t,context:c}=Object(a.O)(e);Object(a.E)("context",c.value);const l=Object(a.H)([]),n=Object(a.d)(()=>l.value[l.value.length-1]),s=Object(a.d)({get:()=>!!l.value.length,set(e){e||(l.value=[])}}),i=()=>{l.value=[]},o=()=>{l.value.pop()},r={pushToInnerForms:e=>{l.value.push(e)},toPrevInderForm:o,clearInnerForms:i};return Object(a.E)("innerFormInstance",r),{forms:t,contexts:c,getComponentType:e=>{const{schemes:t}=c.value;return t[e.scheme].type},isShowChildViewPopup:s,currDisplayChildView:n,toPrevInderForm:o,clearInnerForms:i,innerForms:l}}});c(265);var J=f()(H,[["render",function(e,t,c,l,n,u){const d=Object(a.J)("RenderItem"),b=Object(a.J)("van-popup");return Object(a.C)(),Object(a.h)(a.a,null,[Object(a.i)("div",s,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.forms,(t,c)=>(Object(a.C)(),Object(a.f)(d,{key:c,type:e.getComponentType(t),form:t},null,8,["type","form"]))),128))]),Object(a.k)(b,{show:e.isShowChildViewPopup,"onUpdate:show":t[2]||(t[2]=t=>e.isShowChildViewPopup=t),position:"bottom",style:{height:"80%"}},{default:Object(a.T)(()=>[e.isShowChildViewPopup?(Object(a.C)(),Object(a.h)("div",i,[Object(a.i)("header",o,[Object(a.i)("span",{onClick:t[0]||(t[0]=(...t)=>e.toPrevInderForm&&e.toPrevInderForm(...t))},"返回"),Object(a.i)("span",null,Object(a.N)(e.currDisplayChildView.title),1),Object(a.i)("span",{onClick:t[1]||(t[1]=(...t)=>e.clearInnerForms&&e.clearInnerForms(...t))},"关闭")]),Object(a.i)("div",r,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.currDisplayChildView.formData,t=>(Object(a.C)(),Object(a.f)(d,{key:t,type:e.getComponentType(t),form:t},null,8,["type","form"]))),128))])])):Object(a.g)("",!0)]),_:1},8,["show"])],64)}],["__scopeId","data-v-71714add"]]),A=Object(a.l)({name:"FieldCustomForm",components:{renderView:J},props:{item:{type:Object,default:()=>({})}},setup(e){const{item:t}=Object(a.O)(e),c=t.value.value;return{formData:Object(a.d)(()=>c.form_data),context:Object(a.d)(()=>({config:c.config||{},schemes:c.schemes}))}}});c(266);const B=f()(A,[["render",function(e,t,c,s,i,o){const r=Object(a.J)("renderView");return Object(a.C)(),Object(a.h)("p",l,[Object(a.i)("label",n,Object(a.N)(e.item.name),1),Object(a.k)(r,{"form-data":e.formData,context:e.context},null,8,["form-data","context"])])}],["__scopeId","data-v-7519209c"]]);t.default=B},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={key:1,class:"common-view-field"},n={class:"view-label"},s={class:"view-value"},i=["href"];const o=/(http|https):\/\/([\w.]+\/?)\S*/;var r=Object(a.l)({name:"FieldLink",props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:t}){const{item:c}=Object(a.O)(e),l=Object(a.H)(""),n=Object(a.d)(()=>"REQUIRE"===c.value.validate_type);l.value=c.value.value,Object(a.R)(l,e=>{t("change",e)});const s=Object(a.G)({error:!1,errorMessage:""});return{item:c,isRequire:n,val:l,validate:()=>n.value&&!l.value?(s.error=!0,s.errorMessage="必填字段",!1):o.test(l.value)?(s.error=!1,s.errorMessage="",!0):(s.error=!0,s.errorMessage="请输入正确的链接",!1),...Object(a.O)(s)}}}),u=(c(270),c(30));const d=c.n(u)()(r,[["render",function(e,t,c,o,r,u){const d=Object(a.J)("van-field");return e.isViewMode?(Object(a.C)(),Object(a.h)("p",l,[Object(a.i)("label",n,Object(a.N)(e.item.name),1),Object(a.i)("span",s,[Object(a.i)("a",{class:"ui-url",href:e.item.value,title:"item.valu",target:"_blank"},Object(a.N)(e.item.value||"--"),9,i)])])):(Object(a.C)(),Object(a.f)(d,{key:0,modelValue:e.val,"onUpdate:modelValue":t[0]||(t[0]=t=>e.val=t),required:e.isRequire,error:e.error,"error-message":e.errorMessage,label:e.item.name,placeholder:"请输入"+e.item.name,maxlength:"120",onBlur:e.validate},null,8,["modelValue","required","error","error-message","label","placeholder","onBlur"]))}],["__scopeId","data-v-704033cc"]]);t.default=d},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={class:"check-box"},n={key:1,class:"common-view-field"},s={class:"view-label"},i={class:"view-value"};var o=Object(a.l)({name:"FieldCheckbox",props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:t}){const{item:c}=Object(a.O)(e),l=Object(a.H)([]),n=Object(a.d)(()=>"REQUIRE"===c.value.validate_type),s=Object(a.H)(""),i=()=>{const{choice:e,value:t}=c.value;if(t){const c=t.split(","),a=[],n=[];e.forEach(e=>{c.includes(e.key)&&(a.push(e.name),n.push(e.key))}),s.value=a.join("/"),l.value=n}};i(),Object(a.R)(l,e=>{t("change",e.join(","))});const o=Object(a.G)({error:!1,errorMessage:""});return{item:c,checked:l,isRequire:n,isSelectText:s,...Object(a.O)(o),getDeafaultCheck:i,validate:()=>n.value&&!l.value.length?(o.error=!0,o.errorMessage="必填字段",!1):(o.error=!1,o.errorMessage="",!0)}}}),r=(c(261),c(30));const u=c.n(r)()(o,[["render",function(e,t,c,o,r,u){const d=Object(a.J)("van-checkbox"),b=Object(a.J)("van-checkbox-group"),O=Object(a.J)("van-field");return Object(a.C)(),Object(a.h)("div",l,[e.isViewMode?(Object(a.C)(),Object(a.h)("p",n,[Object(a.i)("label",s,Object(a.N)(e.item.name),1),Object(a.i)("span",i,Object(a.N)(e.isSelectText||"--"),1)])):(Object(a.C)(),Object(a.f)(O,{key:0,label:e.item.name,required:e.isRequire,error:e.error,"error-message":e.errorMessage,class:"vant-checkbox-correct"},{input:Object(a.T)(()=>[Object(a.k)(b,{modelValue:e.checked,"onUpdate:modelValue":t[0]||(t[0]=t=>e.checked=t),direction:"horizontal"},{default:Object(a.T)(()=>[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.item.choice,(e,t)=>(Object(a.C)(),Object(a.f)(d,{key:t,name:e.key,shape:"square"},{default:Object(a.T)(()=>[Object(a.j)(Object(a.N)(e.name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","required","error","error-message"]))])}],["__scopeId","data-v-5a4e2864"]]);t.default=u},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={class:"date-field"},n={key:1,class:"common-view-field"},s={class:"view-label"},i={class:"view-value"};var o=c(170),r=c.n(o),u=Object(a.l)({name:"FieldDate",props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:t}){const{item:c,isViewMode:l}=Object(a.O)(e),n=Object(a.d)(()=>"REQUIRE"===c.value.validate_type),s=Object(a.G)({value:c.value.value,dateValue:new Date(c.value.value),minDate:r()().subtract(3,"year").toDate(),showPicker:!1}),i=Object(a.G)({error:!1,errorMessage:""}),o={year:"年",month:"月",day:"日"};return{state:s,isRequire:n,handleFieldClick:()=>{l.value||(s.showPicker=!0)},onConfirm:e=>{s.value=r()(e).format("YYYY-MM-DD"),s.dateValue=new Date(e),s.showPicker=!1,t("change",s.value)},validate:()=>n.value&&!s.value?(i.error=!0,i.errorMessage="必填字段",!1):(i.error=!1,i.errorMessage="",!0),formatter:(e,t)=>`${t}${o[e]}`,...Object(a.O)(i)}}}),d=(c(267),c(30));const b=c.n(d)()(u,[["render",function(e,t,c,o,r,u){const d=Object(a.J)("van-field"),b=Object(a.J)("van-datetime-picker"),O=Object(a.J)("van-popup");return Object(a.C)(),Object(a.h)("div",l,[e.isViewMode?(Object(a.C)(),Object(a.h)("p",n,[Object(a.i)("label",s,Object(a.N)(e.item.name),1),Object(a.i)("span",i,Object(a.N)(e.state.value||"--"),1)])):(Object(a.C)(),Object(a.f)(d,{key:0,modelValue:e.state.value,"onUpdate:modelValue":t[0]||(t[0]=t=>e.state.value=t),name:"datepicker",readonly:"",error:e.error,clickable:!e.isViewMode,label:e.item.name,required:e.isRequire,placeholder:"请选择日期",onClick:e.handleFieldClick},null,8,["modelValue","error","clickable","label","required","onClick"])),Object(a.k)(O,{show:e.state.showPicker,"onUpdate:show":t[2]||(t[2]=t=>e.state.showPicker=t),position:"bottom"},{default:Object(a.T)(()=>[Object(a.k)(b,{type:"date","model-value":e.state.dateValue,"min-date":e.state.minDate,formatter:e.formatter,onConfirm:e.onConfirm,onCancel:t[1]||(t[1]=t=>e.state.showPicker=!1)},null,8,["model-value","min-date","formatter","onConfirm"])]),_:1},8,["show"])])}],["__scopeId","data-v-352df94a"]]);t.default=b},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={class:"datetime-field"},n={key:1,class:"common-view-field"},s={class:"view-label"},i={class:"view-value"};var o=c(170),r=c.n(o),u=Object(a.l)({name:"FieldDateTime",props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:t}){const{item:c,isViewMode:l}=Object(a.O)(e),n=Object(a.d)(()=>"REQUIRE"===c.value.validate_type),s=Object(a.G)({value:c.value.value,dateValue:new Date(c.value.value),minDate:r()().subtract(3,"year").toDate(),showPicker:!1}),i=Object(a.G)({error:!1,errorMessage:""}),o={year:"年",month:"月",day:"日",hour:"时",minute:"分"};return{state:s,isRequire:n,handleFieldClick:()=>{l.value||(s.showPicker=!0)},onConfirm:e=>{s.value=r()(e).format("YYYY-MM-DD HH:mm:ss"),s.dateValue=new Date(e),s.showPicker=!1,t("change",s.value)},validate:()=>n.value&&!s.value?(i.error=!0,i.errorMessage="必填字段",!1):(i.error=!1,i.errorMessage="",!0),formatter:(e,t)=>`${t}${o[e]}`,...Object(a.O)(i)}}}),d=(c(268),c(30));const b=c.n(d)()(u,[["render",function(e,t,c,o,r,u){const d=Object(a.J)("van-field"),b=Object(a.J)("van-datetime-picker"),O=Object(a.J)("van-popup");return Object(a.C)(),Object(a.h)("div",l,[e.isViewMode?(Object(a.C)(),Object(a.h)("p",n,[Object(a.i)("label",s,Object(a.N)(e.item.name),1),Object(a.i)("span",i,Object(a.N)(e.state.value||"--"),1)])):(Object(a.C)(),Object(a.f)(d,{key:0,modelValue:e.state.value,"onUpdate:modelValue":t[0]||(t[0]=t=>e.state.value=t),name:"datepicker",readonly:"",error:e.error,clickable:!e.isViewMode,label:e.item.name,required:e.isRequire,placeholder:"请选择时间",onClick:e.handleFieldClick},null,8,["modelValue","error","clickable","label","required","onClick"])),Object(a.k)(O,{show:e.state.showPicker,"onUpdate:show":t[2]||(t[2]=t=>e.state.showPicker=t),position:"bottom"},{default:Object(a.T)(()=>[Object(a.k)(b,{type:"datetime","model-value":e.state.dateValue,formatter:e.formatter,"min-date":e.state.minDate,onConfirm:e.onConfirm,onCancel:t[1]||(t[1]=t=>e.state.showPicker=!1)},null,8,["model-value","formatter","min-date","onConfirm"])]),_:1},8,["show"])])}],["__scopeId","data-v-c305680c"]]);t.default=b},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={class:"field-file"},n={class:"ui-field-label"},s={key:0,class:"uploader-wrap"},i={key:1,class:"upload-list"},o=["onClick"],r={key:0,class:"upload-item"};var u=Object(a.l)({name:"FieldFile",props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:t}){const{item:c}=Object(a.O)(e),l=Object(a.H)([]),n=Object(a.H)(1010),s=Object(a.H)(""),i=Object(a.d)(()=>c.value.value||"{}");s.value=i.value,Object(a.R)(i,e=>{e.value=e.value}),Object(a.R)(s,e=>{t("change",e)});const o=Object(a.d)(()=>{const e=[],t=JSON.parse(s.value);return Object.keys(t).forEach(c=>{e.push({key:c,...t[c]})}),e}),r=e=>{const t=new FormData,c=new XMLHttpRequest,{name:a}=e.file;t.append(a,e.file),c.onreadystatechange=()=>{if(4===c.readyState)try{const t=JSON.parse(c.responseText);200===c.status?(e.status="done",e.succeed_files=t.data.succeed_files):(e.status="failed",e.message="失败",console.error(t.message))}catch(t){e.status="failed",e.message=t.message,console.error(t.message)}finally{(()=>{n.value=(new Date).getTime();const e=l.value.reduce((e,t)=>("done"===t.status&&(e={...e,...t.succeed_files}),e),{});s.value=JSON.stringify(e)})()}},c.withCredentials=!0,c.open("POST",window.SITE_URL+"weixin/api/misc/upload_file/",!0),c.send(t)};return{val:s,item:c,validate:()=>!!s.value&&"{}"!==s.value,afterRead:e=>{console.log(e,"filefilefilefile"),e.status="uploading",e.message="上传中...",r(e)},fileList:l,updateKey:n,uploadList:o,originValue:i,handleDownFileClick:e=>{const t=`${window.SITE_URL}weixin/api/ticket/fields/${c.value.id}/download_file/?unique_key=${e.key}&file_type=ticket`;window.open(t)}}}}),d=(c(269),c(30));const b=c.n(d)()(u,[["render",function(e,t,c,u,d,b){const O=Object(a.J)("van-uploader"),j=Object(a.J)("van-icon");return Object(a.C)(),Object(a.h)("div",l,[Object(a.i)("label",n,Object(a.N)(e.item.name),1),e.isViewMode?(Object(a.C)(),Object(a.h)("ul",i,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.uploadList,(t,c)=>(Object(a.C)(),Object(a.h)("li",{key:c,class:"upload-item"},[Object(a.j)(Object(a.N)(t.name)+" ",1),Object(a.i)("span",{class:"down-icon",onClick:c=>e.handleDownFileClick(t)},[Object(a.k)(j,{name:"down"})],8,o)]))),128)),e.uploadList.length?Object(a.g)("",!0):(Object(a.C)(),Object(a.h)("li",r,"无"))])):(Object(a.C)(),Object(a.h)("div",s,[(Object(a.C)(),Object(a.f)(O,{key:e.updateKey,modelValue:e.fileList,"onUpdate:modelValue":t[0]||(t[0]=t=>e.fileList=t),"preview-size":"80px","upload-icon":"add-o",multiple:!0,"max-size":209715200,accept:".txt,.log,.pdf,.doc,.ppt,.xls,.docx,.pptx,.xlsx,.zip,.jpg,.png","after-read":e.afterRead},null,8,["modelValue","after-read"]))]))])}]]);t.default=b},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={key:1,class:"common-view-field"},n={class:"view-label"},s={class:"view-value"};var i=c(88),o=Object(a.l)({name:"FieldInputSelect",components:{NotSupport:i.a},props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},setup(e){const{item:t}=Object(a.O)(e),c=Object(a.d)(()=>t.value.value.split(",").map(e=>{const c=t.value.choice.find(t=>t.key===e);return c?c.name:""}).join(",")),l=Object(a.d)(()=>"REQUIRE"===t.value.validate_type);return{item:t,validate:()=>!(l.value&&!t.value.value),displayValue:c}}}),r=c(30);const u=c.n(r)()(o,[["render",function(e,t,c,i,o,r){const u=Object(a.J)("not-support");return e.isViewMode?(Object(a.C)(),Object(a.h)("p",l,[Object(a.i)("label",n,Object(a.N)(e.item.name),1),Object(a.i)("span",s,Object(a.N)(e.displayValue||"--"),1)])):(Object(a.C)(),Object(a.f)(u,{key:0,item:e.item},null,8,["item"]))}]]);t.default=u},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={key:1,class:"common-view-field"},n={class:"view-label"},s={class:"view-value"};var i=Object(a.l)({name:"FieldInt",props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:t}){const{item:c}=Object(a.O)(e),l=Object(a.H)(""),n=Object(a.d)(()=>"REQUIRE"===c.value.validate_type);l.value=c.value.value,Object(a.R)(l,e=>{t("change",e)});const s=Object(a.G)({error:!1,errorMessage:""});return{item:c,val:l,validate:()=>n.value&&!l.value?(s.error=!0,s.errorMessage="必填字段",!1):(s.error=!1,s.errorMessage="",!0),isRequire:n,...Object(a.O)(s)}}}),o=c(30);const r=c.n(o)()(i,[["render",function(e,t,c,i,o,r){const u=Object(a.J)("van-field");return e.isViewMode?(Object(a.C)(),Object(a.h)("p",l,[Object(a.i)("label",n,Object(a.N)(e.item.name),1),Object(a.i)("span",s,Object(a.N)(e.item.value||"--"),1)])):(Object(a.C)(),Object(a.f)(u,{key:0,modelValue:e.val,"onUpdate:modelValue":t[0]||(t[0]=t=>e.val=t),type:"number",required:e.isRequire,error:e.error,label:e.item.name,placeholder:"请输入"+e.item.name,onBlur:e.validate},null,8,["modelValue","required","error","label","placeholder","onBlur"]))}]]);t.default=r},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={key:1,class:"common-view-field"},n={class:"view-label"},s={class:"view-value"};var i=c(88),o=Object(a.l)({name:"FieldMember",components:{NotSupport:i.a},props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},setup(e){const{item:t}=Object(a.O)(e),c=Object(a.d)(()=>"REQUIRE"===t.value.validate_type);return{item:t,validate:()=>!(c.value&&!t.value.value)}}}),r=c(30);const u=c.n(r)()(o,[["render",function(e,t,c,i,o,r){const u=Object(a.J)("not-support");return e.isViewMode?(Object(a.C)(),Object(a.h)("p",l,[Object(a.i)("label",n,Object(a.N)(e.item.name),1),Object(a.i)("span",s,Object(a.N)(e.item.value||"--"),1)])):(Object(a.C)(),Object(a.f)(u,{key:0,item:e.item},null,8,["item"]))}]]);t.default=u},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={key:1,class:"common-view-field"},n={class:"view-label"},s={class:"view-value"};var i=c(88),o=Object(a.l)({name:"FieldMembers",components:{NotSupport:i.a},props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},setup(e){const{item:t}=Object(a.O)(e),c=Object(a.d)(()=>"REQUIRE"===t.value.validate_type);return{item:t,validate:()=>!(c.value&&!t.value.value)}}}),r=c(30);const u=c.n(r)()(o,[["render",function(e,t,c,i,o,r){const u=Object(a.J)("not-support");return e.isViewMode?(Object(a.C)(),Object(a.h)("p",l,[Object(a.i)("label",n,Object(a.N)(e.item.name),1),Object(a.i)("span",s,Object(a.N)(e.item.value||"--"),1)])):(Object(a.C)(),Object(a.f)(u,{key:0,item:e.item},null,8,["item"]))}]]);t.default=u},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={key:1,class:"common-view-field"},n={class:"view-label"},s={class:"view-value"};var i=c(88),o=Object(a.l)({name:"FieldMultiSelect",components:{NotSupport:i.a},props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},setup(e){const{item:t}=Object(a.O)(e),c=Object(a.d)(()=>t.value.value.split(",").map(e=>{const c=t.value.choice.find(t=>t.key===e);return c?c.name:""}).join(",")),l=Object(a.d)(()=>"REQUIRE"===t.value.validate_type);return{item:t,displayValue:c,validate:()=>!(l.value&&!t.value.value)}}}),r=c(30);const u=c.n(r)()(o,[["render",function(e,t,c,i,o,r){const u=Object(a.J)("not-support");return e.isViewMode?(Object(a.C)(),Object(a.h)("p",l,[Object(a.i)("label",n,Object(a.N)(e.item.name),1),Object(a.i)("span",s,Object(a.N)(e.displayValue||"--"),1)])):(Object(a.C)(),Object(a.f)(u,{key:0,item:e.item},null,8,["item"]))}]]);t.default=u},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={class:"radio-box"},n={key:1,class:"common-view-field"},s={class:"view-label"},i={class:"view-value"};var o=Object(a.l)({name:"FieldRadio",props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:t}){const{item:c}=Object(a.O)(e),l=Object(a.H)(""),n=Object(a.d)(()=>"REQUIRE"===c.value.validate_type),s=Object(a.H)(""),i=()=>{const{choice:e,value:t}=c.value;if(t){const c=t.split(",");e.forEach(e=>{c.includes(e.key)&&(s.value=e.name,l.value=e.key)})}};i(),Object(a.R)(l,e=>{t("change",e)});const o=Object(a.G)({error:!1,errorMessage:""});return{item:c,checked:l,isRequire:n,isSelectText:s,...Object(a.O)(o),getDeafaultCheck:i,validate:()=>n.value&&!l.value?(o.error=!0,o.errorMessage="必填字段",!1):(o.error=!1,o.errorMessage="",!0)}}}),r=(c(271),c(30));const u=c.n(r)()(o,[["render",function(e,t,c,o,r,u){const d=Object(a.J)("van-radio"),b=Object(a.J)("van-radio-group"),O=Object(a.J)("van-field");return Object(a.C)(),Object(a.h)("div",l,[e.isViewMode?(Object(a.C)(),Object(a.h)("p",n,[Object(a.i)("label",s,Object(a.N)(e.item.name),1),Object(a.i)("span",i,Object(a.N)(e.isSelectText||"--"),1)])):(Object(a.C)(),Object(a.f)(O,{key:0,label:e.item.name,required:e.isRequire,error:e.error,"error-message":e.errorMessage,class:"vant-radio-correct"},{input:Object(a.T)(()=>[Object(a.k)(b,{modelValue:e.checked,"onUpdate:modelValue":t[0]||(t[0]=t=>e.checked=t),direction:"horizontal"},{default:Object(a.T)(()=>[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.item.choice,(e,t)=>(Object(a.C)(),Object(a.f)(d,{key:t,name:e.key},{default:Object(a.T)(()=>[Object(a.j)(Object(a.N)(e.name),1)]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label","required","error","error-message"]))])}],["__scopeId","data-v-4190c948"]]);t.default=u},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={key:1,class:"common-view-field"},n={class:"view-label"},s=["innerHTML"],i={key:1,class:"view-value"};var o=c(88),r=Object(a.l)({name:"FieldRichtext",components:{NotSupport:o.a},props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},setup(e){const{item:t}=Object(a.O)(e),c=Object(a.d)(()=>"REQUIRE"===t.value.validate_type);return{item:t,validate:()=>!(c.value&&!t.value.value)}}}),u=(c(272),c(30));const d=c.n(u)()(r,[["render",function(e,t,c,o,r,u){const d=Object(a.J)("not-support");return e.isViewMode?(Object(a.C)(),Object(a.h)("p",l,[Object(a.i)("label",n,Object(a.N)(e.item.name),1),e.item.value?(Object(a.C)(),Object(a.h)("span",{key:0,class:"view-value richtext-ui",innerHTML:e.item.value},null,8,s)):(Object(a.C)(),Object(a.h)("span",i,"--"))])):(Object(a.C)(),Object(a.f)(d,{key:0,item:e.item},null,8,["item"]))}]]);t.default=d},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={class:"select"},n={key:1,class:"common-view-field"},s={class:"view-label"};var i=Object(a.l)({name:"FieldSelect",props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1},highlightRefuse:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:t}){const{item:c}=Object(a.O)(e),l=Object(a.H)(!1),n=Object(a.H)(0),s=Object(a.H)(null),i=Object(a.H)({id:0,name:"",key:""}),o=Object(a.d)(()=>"REQUIRE"===c.value.validate_type);(()=>{const{choice:e,value:t}=c.value;if(t){const c=e.find(e=>String(e.key)===String(t));i.value=c||{name:t,key:t}}})();const r=Object(a.G)({error:!1,errorMessage:""});return{item:c,showPicker:l,columnIndex:n,pickerRef:s,selectInfo:i,isRequire:o,...Object(a.O)(r),handelerOpenPopup:()=>{l.value=!0,Object(a.s)(()=>{const{choice:e}=c.value,{key:t}=i.value;n.value=e.findIndex(e=>e.key===t),s.value.setColumnIndex(0,n.value)})},onConfirm:e=>{l.value=!1,i.value=e,t("change",i.value.key)},onCancel:()=>{l.value=!1},validate:()=>o.value&&!i.value.key?(r.error=!0,r.errorMessage="必填字段",!1):(r.error=!1,r.errorMessage="",!0)}}}),o=(c(273),c(30));const r=c.n(o)()(i,[["render",function(e,t,c,i,o,r){const u=Object(a.J)("van-field"),d=Object(a.J)("van-picker"),b=Object(a.J)("van-popup");return Object(a.C)(),Object(a.h)("div",l,[e.isViewMode?(Object(a.C)(),Object(a.h)("p",n,[Object(a.i)("label",s,Object(a.N)(e.item.name),1),Object(a.i)("span",{class:Object(a.t)(["view-value",{highlight:e.item.meta&&"APPROVE_RESULT"===e.item.meta.code&&"false"===e.item.value}])},Object(a.N)(e.selectInfo.name||"--"),3)])):(Object(a.C)(),Object(a.f)(u,{key:0,modelValue:e.selectInfo.name,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selectInfo.name=t),label:e.item.name,required:e.isRequire,error:e.error,"error-message":e.errorMessage,placeholder:"请选择",onClick:e.handelerOpenPopup},null,8,["modelValue","label","required","error","error-message","onClick"])),Object(a.k)(b,{show:e.showPicker,"onUpdate:show":t[1]||(t[1]=t=>e.showPicker=t),round:"",position:"bottom"},{default:Object(a.T)(()=>[Object(a.k)(d,{ref:"pickerRef","show-toolbar":"",title:"请选择"+e.item.name,columns:e.item.choice,"default-index":e.columnIndex,"value-key":"name",onCancel:e.onCancel,onConfirm:e.onConfirm},null,8,["title","columns","default-index","onCancel","onConfirm"])]),_:1},8,["show"])])}],["__scopeId","data-v-0e0aedf8"]]);t.default=r},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={key:1,class:"common-view-field"},n={class:"view-label"},s={class:"view-value"};var i=Object(a.l)({name:"FieldString",props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:t}){const{item:c}=Object(a.O)(e),l=Object(a.H)(""),n=Object(a.d)(()=>"REQUIRE"===c.value.validate_type);l.value=c.value.value,Object(a.R)(l,e=>{t("change",e)});const s=Object(a.G)({error:!1,errorMessage:""});return{item:c,val:l,validate:()=>n.value&&!l.value?(s.error=!0,s.errorMessage="必填字段",!1):(s.error=!1,s.errorMessage="",!0),isRequire:n,...Object(a.O)(s)}}}),o=c(30);const r=c.n(o)()(i,[["render",function(e,t,c,i,o,r){const u=Object(a.J)("van-field");return e.isViewMode?(Object(a.C)(),Object(a.h)("p",l,[Object(a.i)("label",n,Object(a.N)(e.item.name),1),Object(a.i)("span",s,Object(a.N)(e.item.value||"--"),1)])):(Object(a.C)(),Object(a.f)(u,{key:0,modelValue:e.val,"onUpdate:modelValue":t[0]||(t[0]=t=>e.val=t),required:e.isRequire,error:e.error,"error-message":e.errorMessage,label:e.item.name,placeholder:"请输入"+e.item.name,onBlur:e.validate},null,8,["modelValue","required","error","error-message","label","placeholder","onBlur"]))}]]);t.default=r},function(e,t,c){"use strict";c.r(t);var a=c(0);const l=Object(a.j)(" FieldSTable ");var n=Object(a.l)({name:"FieldSTable",props:{item:{type:Object,default:()=>({})}},setup(e){const{item:t}=Object(a.O)(e);return{item:t}}}),s=c(30);const i=c.n(s)()(n,[["render",function(e,t,c,n,s,i){const o=Object(a.J)("van-cell");return Object(a.C)(),Object(a.f)(o,{title:e.item.name,value:"内容"},{default:Object(a.T)(()=>[l]),_:1},8,["title"])}]]);t.default=i},function(e,t,c){"use strict";c.r(t);var a=c(0);const l={key:1,class:"common-view-field"},n={class:"view-label"},s={class:"view-value"};var i=Object(a.l)({name:"FieldText",props:{item:{type:Object,default:()=>({})},isViewMode:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:t}){const{item:c}=Object(a.O)(e),l=Object(a.H)(""),n=Object(a.d)(()=>"REQUIRE"===c.value.validate_type);l.value=c.value.value,Object(a.R)(l,e=>{t("change",e)});const s=Object(a.G)({error:!1,errorMessage:""});return{item:c,val:l,validate:()=>n.value&&!l.value?(s.error=!0,s.errorMessage="必填字段",!1):(s.error=!1,s.errorMessage="",!0),isRequire:n,...Object(a.O)(s)}}}),o=c(30);const r=c.n(o)()(i,[["render",function(e,t,c,i,o,r){const u=Object(a.J)("van-field");return e.isViewMode?(Object(a.C)(),Object(a.h)("p",l,[Object(a.i)("label",n,Object(a.N)(e.item.name),1),Object(a.i)("span",s,Object(a.N)(e.item.value||"--"),1)])):(Object(a.C)(),Object(a.f)(u,{key:0,modelValue:e.val,"onUpdate:modelValue":t[0]||(t[0]=t=>e.val=t),type:"textarea",rows:"4",required:e.isRequire,error:e.error,label:e.item.name,placeholder:"请输入"+e.item.name,onBlur:e.validate},null,8,["modelValue","required","error","label","placeholder","onBlur"]))}]]);t.default=r},function(e,t,c){"use strict";c.r(t);var a=c(0);const l=Object(a.j)(" FieldSTree "),n=Object(a.j)(" 预览 "),s=Object(a.j)(" 编辑 ");var i=Object(a.l)({name:"FieldSTree",props:{item:{type:Object,default:()=>({})},isPreview:{type:Boolean,default:!1}},setup(e){const{item:t}=Object(a.O)(e);return{item:t}}}),o=c(30);const r=c.n(o)()(i,[["render",function(e,t,c,i,o,r){const u=Object(a.J)("van-cell");return Object(a.C)(),Object(a.f)(u,{title:e.item.name,value:"内容"},{default:Object(a.T)(()=>[l,e.isPreview?(Object(a.C)(),Object(a.h)(a.a,{key:0},[n],64)):(Object(a.C)(),Object(a.h)(a.a,{key:1},[s],64))]),_:1},8,["title"])}]]);t.default=r},,function(e,t,c){"use strict";c.r(t);var a=c(0);const l=e=>(Object(a.F)("data-v-42f080fb"),e=e(),Object(a.D)(),e),n={ref:"ticketPage",class:"ticket-page"},s=[l(()=>Object(a.i)("h4",{class:""},"处理进度",-1))],i=[l(()=>Object(a.i)("i",{class:"itsm-mobile-icon icon-index"},null,-1))];var o=c(25),r=c(26),u=c(201),d=c.n(u);const b=e=>(Object(a.F)("data-v-42631fb9"),e=e(),Object(a.D)(),e),O={class:"message-card"},j={class:"info-content van-hairline--bottom"},p={class:"info-sn"},v={class:"info-effect"},m={class:"effect-btn"},f=b(()=>Object(a.i)("i",{class:"itsm-mobile-icon icon-chehui revoke-icon"},null,-1)),h=Object(a.j)(" 撤单 "),k={key:0,class:"itsm-mobile-icon icon-favorite-o"},y=b(()=>Object(a.i)("div",{class:"van-dialog__message"},"确定撤销当前单据？",-1)),C=b(()=>Object(a.i)("div",{class:"van-dialog__message"},"取消关注后，将不再接收工单的进度更新",-1));var g=c(307),w=Object(a.l)({name:"TicketBasicInfo",props:{ticketDetail:{type:Object,default:()=>({})}},emits:["revoke"],setup(e,{emit:t}){const{ticketDetail:c}=Object(a.O)(e),l=Object(o.b)(),n=Object(a.H)([]),s=Object(a.H)(!1),i=Object(a.H)(!1);n.value=c.value.table_fields,n.value.forEach(e=>{"impact"===e.key?c.value.impact=e.display_value:"urgency"===e.key&&(c.value.urgency=e.display_value)});const r=c.value.followers.some(e=>e===window.username);c.value.hasAttention=r||!1;const u=async e=>{if("cancel"===e)return void(i.value=!1);const t=!c.value.hasAttention,a={id:c.value.id,attention:t};try{await l.dispatch("ticket/addFollower",a),c.value.hasAttention=t,g.a.success({message:t?"添加关注成功":"取消关注成功",icon:"passed",className:"common-toast"})}catch(e){console.error(e)}finally{i.value=!1}};return{isRevokeDialogShow:s,isFollowDialogShow:i,getStatusColor:e=>{let t="#63656e";const c=l.state.serviceConfig[e.service_type];return c&&(t=c.find(t=>t.key===e.current_status).color_hex),{color:t,borderColor:t}},onRevokeClick:()=>{s.value=!0},revokeTicket:async e=>{if("cancel"!==e)try{await l.dispatch("ticket/withdraw",{id:c.value.id}),c.value.can_withdraw=!1,t("revoke")}catch(e){console.error(e)}finally{s.value=!1}else s.value=!1},onFollowClick:()=>{c.value.hasAttention?i.value=!0:u()},changeFollowStatus:u}}}),N=(c(213),c(30)),_=c.n(N);var I=_()(w,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("van-button"),o=Object(a.J)("van-dialog");return Object(a.C)(),Object(a.h)("div",O,[Object(a.i)("div",j,[Object(a.i)("h5",null,Object(a.N)(e.ticketDetail.title),1),Object(a.i)("div",p,[Object(a.i)("span",{class:"ticket-status",style:Object(a.u)(e.getStatusColor(e.ticketDetail))},Object(a.N)(e.ticketDetail.current_status_display),5),Object(a.j)(" "+Object(a.N)(e.ticketDetail.sn)+" | 提单人 ："+Object(a.N)(e.ticketDetail.creator),1)]),Object(a.i)("p",null,"服务 ："+Object(a.N)(e.ticketDetail.catalog_fullname)+" > "+Object(a.N)(e.ticketDetail.service_name),1),Object(a.i)("p",null,"提单时间 ："+Object(a.N)(e.ticketDetail.create_at),1),Object(a.i)("div",v,[Object(a.i)("div",m,[e.ticketDetail.can_withdraw?(Object(a.C)(),Object(a.f)(i,{key:0,class:"revoke-btn",onClick:t[0]||(t[0]=t=>e.onRevokeClick(e.ticketDetail.id))},{default:Object(a.T)(()=>[f,h]),_:1})):Object(a.g)("",!0),Object(a.k)(i,{onClick:e.onFollowClick},{default:Object(a.T)(()=>[e.ticketDetail.hasAttention?Object(a.g)("",!0):(Object(a.C)(),Object(a.h)("i",k)),Object(a.j)(" "+Object(a.N)(e.ticketDetail.hasAttention?"已关注":"关注"),1)]),_:1},8,["onClick"])])])]),Object(a.k)(o,{show:e.isRevokeDialogShow,"onUpdate:show":t[1]||(t[1]=t=>e.isRevokeDialogShow=t),"class-name":"common-dialog","confirm-button-color":"#3a84ff","cancel-button-color":"#3a84ff","show-cancel-button":!0,"before-close":e.revokeTicket},{default:Object(a.T)(()=>[y]),_:1},8,["show","before-close"]),Object(a.k)(o,{show:e.isFollowDialogShow,"onUpdate:show":t[2]||(t[2]=t=>e.isFollowDialogShow=t),"class-name":"common-dialog","confirm-button-color":"#3a84ff","cancel-button-color":"#3a84ff","confirm-button-text":"取消关注","cancel-button-text":"再想想","show-cancel-button":!0,"before-close":e.changeFollowStatus},{default:Object(a.T)(()=>[C]),_:1},8,["show","before-close"])])}],["__scopeId","data-v-42631fb9"]]);const T={class:"content-wrap"},E={class:"scroll-content"},R=(e=>(Object(a.F)("data-v-0d233788"),e=e(),Object(a.D)(),e))(()=>Object(a.i)("p",{class:"detail-title van-hairline--bottom"},"提单详情",-1)),S={class:"field-info"};const D=(e,t)=>{let c=null;return function a(...l){null!==c&&clearTimeout(c),c=setTimeout(()=>{e.call(a,...l)},t)}};var x=c(88),V=(c(134),c(228),c(161),c(232),c(163),c(243),c(250),c(255),c(257),c(259),function(){var e=Object(o.b)();return{insertRemoteChoiceData:function(t){t.forEach((function(c){if(!(Array.isArray(c.choice)?c.choice:[]).some((function(e){return e.can_delete}))){var a=c.source_type;"API"===a||"priority"===c.key?function(t,c){var a={id:t.id,api_instance_id:t.api_instance_id,kv_relation:t.kv_relation};t.related_fields&&t.related_fields.rely_on&&t.related_fields.rely_on.forEach((function(e){var t=c.find((function(t){return t.key===e}));t&&(a[e]=t.value||"")})),!(!Object.values(a).every((function(e){return!!e}))||"priority"===t.key)&&(a.api_info=t.api_info,e.dispatch("field/getfieldApiChoice",a).then((function(e){t.choice=e.data.map((function(e){return{key:e.key||e.id,name:e.name}}))})))}(c,t):"DATADICT"===a?function(t){e.dispatch("field/getDatadict",{key:t.source_uri,field_key:t.key,service:t.service,current_status:t.ticket_status}).then((function(e){t.choice=e.data.map((function(e){return{key:e.key,name:e.name,isOver:e.is_over}}))}))}(c):"RPC"===a&&function(t){e.dispatch("field/getRPC",t).then((function(e){t.choice=e.data}))}(c)}}))}}});const F=(()=>{const e=c(260);return e.keys().reduce((t,c)=>{const a=c.match(/^\.\/([\w-]+)/i);if(a){t["Field-"+a[1].toUpperCase()]=e(c).default}return t},{})})(),M=["CUSTOMTABLE","TREESELECT","FILE","CASCADE","SOPS_TEMPLATE","TABLE"],P=["INPUTSELECT","MEMBER","MEMBERS","MULTISELECT","RICHTEXT"];var L=Object(a.l)({name:"RenderField",components:{...F,NotSupport:x.a},props:{fields:{type:Array,default:()=>[]},isViewMode:{type:Boolean,default:!1},highlightRefuse:{type:Boolean,default:!1}},setup(e){const{fields:t}=Object(a.O)(e),c=Object(a.H)(null);let l=[];Object(a.x)(()=>{l=[]});const n=(s=function(e){var t=e.replace(/-/g,"/");return new Date(t).getTime()},i=function(e,t){var c=!1,a=["CHECKBOX","MEMBERS","MULTISELECT","TREESELECT"];switch(t.condition){case"==":c=a.some((function(t){return t===e.type}))?t.value.split(",").map((function(t){return-1===e.val.indexOf(t)})).every((function(e){return!e}))&&e.val.length===t.value.length:e.val===t.value||Number(e.val)===Number(t.value);break;case"!=":if(a.some((function(t){return t===e.type}))){var l=t.value.split(",").map((function(t){return-1===e.val.indexOf(t)}));c=l.some((function(e){return!!e}))?l.some((function(e){return!!e})):e.val.length!==t.value.length}else c=e.val!==t.value&&Number(e.val)!==Number(t.value);break;case">":c="DATE"===e.type||"DATETIME"===e.type?s(e.val)>s(t.value):Number(e.val)>Number(t.value);break;case"<":c="DATE"===e.type||"DATETIME"===e.type?s(e.val)<s(t.value):Number(e.val)<Number(t.value);break;case">=":c="DATE"===e.type||"DATETIME"===e.type?s(e.val)>=s(t.value):Number(e.val)>=Number(t.value);break;case"<=":c="DATE"===e.type||"DATETIME"===e.type?s(e.val)<=s(t.value):Number(e.val)<=Number(t.value);break;case"issuperset":c=t.value.split(",").map((function(t){return-1===e.val.indexOf(t)})).every((function(e){return!e}));break;case"notissuperset":c=!t.value.split(",").map((function(t){return-1===e.val.indexOf(t)})).every((function(e){return!e}));break;default:c=!0}return c},{conditionField:function(e,t){for(var c=0;c<t.length;c++)if(t[c].show_type)t[c].showFeild=!0;else if(t[c].show_conditions.expressions&&t[c].show_conditions.expressions.length)for(var a=0;a<t[c].show_conditions.expressions.length;a++)if(e.key===t[c].show_conditions.expressions[a].key&&e.key===t[c].key&&null===t[c].value)t[c].showFeild=!0;else if(e.key===t[c].show_conditions.expressions[a].key){if(1===t[c].show_conditions.expressions.length)t[c].showFeild=i(e,t[c].show_conditions.expressions[a]);else if("and"===t[c].show_conditions.type){for(var l=[],n=0;n<t[c].show_conditions.expressions.length;n++)for(var s=0;s<t.length;s++)if(t[c].show_conditions.expressions[n].key===t[s].key){var o=i(t[s],t[c].show_conditions.expressions[n]);l.push(o)}t[c].showFeild=l.every((function(e){return!!e}))}else{for(var r=[],u=0;u<t[c].show_conditions.expressions.length;u++)for(var d=0;d<t.length;d++)if(t[c].show_conditions.expressions[u].key===t[d].key){var b=i(t[d],t[c].show_conditions.expressions[u]);r.push(b)}t[c].showFeild=r.some((function(e){return!!e}))}t[c].showFeild=!t[c].showFeild}}});var s,i;const o=()=>{t.value.length&&t.value.forEach(e=>{e.val=e.value,n.conditionField(e,t.value)})};o(),Object(a.R)(t,o);const r=V();r.insertRemoteChoiceData(t.value),Object(a.R)(t,()=>{r.insertRemoteChoiceData(t.value)});const u=D((e,c)=>{const a=t.value.find(e=>e.id===c.id);a.value=e,a.val=e,n.conditionField(a,t.value)},500);return{notSupportTypes:M,renderFieldRef:c,setItemRef:e=>{if(l=l.filter(e=>!!e.item.showFeild),e&&e.item.showFeild){const t=l.findIndex(t=>t.item.id===e.item.id);-1!==t?l[t]=e:l.push(e)}},validate:()=>{const e=[];l.forEach(t=>{const c=t.validate;c instanceof Function&&e.push(c)});const c=e.map(e=>e()).every(e=>e),a=[...P,...M],n=t.value.some(e=>-1!==a.indexOf(e.type));return c&&!n},fieldRefs:l,handleFiledChange:u,getValue:()=>{const e=JSON.parse(JSON.stringify(t.value.filter(e=>!1!==e.showFeild)));return e.forEach(e=>{delete e.val,delete e.showFeild}),e},hasNotSupportRequiredField:()=>{const e=[...P,...M];return t.value.some(t=>{const{type:c,validate_type:a,showFeild:l}=t;return e.includes(c)&&"REQUIRE"===a&&l})}}}});c(274);var H=_()(L,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("not-support"),o=Object(a.J)("van-form");return Object(a.C)(),Object(a.h)("div",{class:Object(a.t)(["render-field",{"is-view-mode":e.isViewMode}])},[Object(a.k)(o,null,{default:Object(a.T)(()=>[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.fields,(t,c)=>(Object(a.C)(),Object(a.h)("div",{key:c,class:Object(a.t)(["field-wrap",{last:c===e.fields.length-1}])},[!1!==t.showFeild?(Object(a.C)(),Object(a.h)(a.a,{key:0},[e.notSupportTypes.includes(t.type)?(Object(a.C)(),Object(a.f)(i,{key:1,"is-view-mode":e.isViewMode,item:t},null,8,["is-view-mode","item"])):(Object(a.C)(),Object(a.f)(Object(a.L)("Field-"+t.type),{key:0,ref_for:!0,ref:e.setItemRef,item:t,"is-view-mode":e.isViewMode,"highlight-refuse":e.highlightRefuse,fields:e.fields,onChange:c=>e.handleFiledChange(c,t)},null,8,["item","is-view-mode","highlight-refuse","fields","onChange"]))],64)):Object(a.g)("",!0)],2))),128))]),_:1})],2)}],["__scopeId","data-v-2755d3c6"]]),J=Object(a.l)({name:"CreateTicketInfo",components:{RenderField:H},props:{fields:{type:Array,default:()=>[]},allFields:{type:Array,default:()=>[]},ticketDetail:{type:Object,default:()=>({})}},setup(e){const{fields:t}=Object(a.O)(e),c=Object(a.H)(!1),l=Object(a.H)(!1);Object(a.R)(t,()=>{n()});const n=()=>{setTimeout(()=>{const e=document.querySelector(".create-ticket-info .scroll-content");if(e){const{height:t}=e.getBoundingClientRect(),c=.5826667*document.body.clientWidth;l.value=t>c}})};return Object(a.z)(()=>{n()}),{unfold:c,showUnfoldIcon:l}}});c(275);var A=_()(J,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("RenderField"),o=Object(a.J)("van-icon");return Object(a.C)(),Object(a.h)("div",{class:Object(a.t)(["create-ticket-info","van-hairline--bottom",{unfold:e.unfold}])},[Object(a.i)("div",T,[Object(a.i)("div",E,[R,Object(a.i)("div",S,[Object(a.k)(i,{"is-view-mode":!0,fields:e.fields,"all-fields":e.allFields},null,8,["fields","all-fields"])])])]),e.showUnfoldIcon?(Object(a.C)(),Object(a.h)("p",{key:0,class:"unfold",onClick:t[0]||(t[0]=t=>e.unfold=!e.unfold)},[e.unfold?(Object(a.C)(),Object(a.f)(o,{key:1,name:"arrow-up"})):(Object(a.C)(),Object(a.f)(o,{key:0,name:"arrow-down"}))])):Object(a.g)("",!0)],2)}],["__scopeId","data-v-0d233788"]]);const B={class:"process-steps"};const U={class:"step-icon"},q={class:"step-icon"},G={key:1,class:"current-node-icon"},z={key:2,class:"operation-btns"},$={key:2,class:"circulation-panel-wrap"},Q={class:"van-dialog__message"};const Y={key:0,class:"task-list"},K=(e=>(Object(a.F)("data-v-290d3a1e"),e=e(),Object(a.D)(),e))(()=>Object(a.i)("p",{class:"list-title"},"任务列表",-1)),W={class:"list-content"},X={class:"van-ellipsis"},Z={class:"item-right"},ee=["onClick"];var te=Object(a.l)({name:"TaskList",props:{id:{type:Number,default:0}},setup(e){const{id:t}=Object(a.O)(e),c=Object(o.b)(),l=Object(a.H)([]),n=Object(a.H)(null),s=async()=>{const e=await c.dispatch("ticket/getTaskList",{ticket_id:t.value});l.value=e.data};s();return{getTaskList:s,taskList:l,statusMap:{NEW:{name:"新"},QUEUE:{name:"待处理"},WAITING_FOR_OPERATE:{name:"待处理"},WAITING_FOR_BACKEND:{name:"后台处理中"},RUNNING:{name:"执行中"},WAITING_FOR_CONFIRM:{name:"待总结",cls:"bk-status-summary"},FINISHED:{name:"已完成",cls:"bk-status-over"},FAILED:{name:"失败",cls:"bk-status-error"},DELETED:{name:"已删除",cls:"bk-status-delete"},REVOKED:{name:"已撤销",cls:"bk-status-revoke"},SUSPENDED:{name:"已暂停",cls:"bk-status-suspend"}},copyCut:e=>{n.value.value=e,n.value.select(),document.execCommand("copy"),n.value.blur(),g.a.success({message:"已复制",icon:"passed",className:"common-toast"})},inputRef:n}}});c(276);var ce=_()(te,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("van-icon");return e.taskList.length?(Object(a.C)(),Object(a.h)("div",Y,[K,Object(a.i)("div",W,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.taskList,t=>(Object(a.C)(),Object(a.h)("div",{key:t.id,class:"content-item"},[Object(a.i)("span",X,Object(a.N)(t.name),1),Object(a.i)("div",Z,[Object(a.i)("i",{class:"itsm-mobile-icon icon-copy copy-icon",onClick:c=>e.copyCut(t.name)},null,8,ee),Object(a.i)("span",{class:Object(a.t)(["item-status",[e.statusMap[t.status].cls]])},["FAILED"===t.status?(Object(a.C)(),Object(a.f)(i,{key:0,name:"warning-o"})):Object(a.g)("",!0),Object(a.j)(" "+Object(a.N)(e.statusMap[t.status].name),1)],2)]),Object(a.i)("input",{ref_for:!0,ref:"inputRef",type:"text"},null,512)]))),128))])])):Object(a.g)("",!0)}],["__scopeId","data-v-290d3a1e"]]);const ae={class:"circulation-panel"},le={class:"btn-area"},ne=Object(a.j)("确定"),se={class:"processor-wrap"},ie={class:"fast-select"},oe=["Key","onClick"];const re={class:"transfer-order"},ue={class:"content-item"},de={class:"van-ellipsis"},be={class:"processor van-ellipsis"},Oe={class:"van-ellipsis"},je={class:"processor van-ellipsis"},pe={key:1,class:"seconed-content"},ve={class:"content-header"},me={class:"title van-ellipsis"},fe={key:0,class:"content-columns"},he={key:1,class:"no-option"};const ke={class:"organization"},ye={class:"org-header"},Ce={key:0,class:"bread-crumb"},ge={key:0,class:"bread-crumb-item van-ellipsis"},we={key:2,class:"bread-crumb-item van-ellipsis"},Ne={class:"org-content"},_e={class:"org-buuton"},Ie={key:0,class:"select"},Te={key:1,class:"not-select"},Ee=Object(a.j)("确定");var Re=Object(a.l)({name:"Organization",props:{isChangeType:{type:Boolean,default:!1}},emits:["change"],setup(e,{emit:t}){const{isChangeType:c}=Object(a.O)(e),l=Object(o.b)(),n=Object(a.H)([]),s=Object(a.H)({id:null,name:""}),i=Object(a.H)([]),r=Object(a.H)(0),u=Object(a.H)([]);Object(a.R)(c,e=>{e||(s.value={id:null,name:""},i.value=[],u.value=n.value,r.value=0)});const d=async()=>{const e=await l.dispatch("ticket/getTreeInfo");n.value=e.data,u.value=n.value};d();const b=(e,t)=>{e.forEach(e=>{e.id!==t?e.children&&b(e.children,t):u.value=e.children})};return{organizationList:u,isCheckedId:r,checkedInfo:s,isBreadCrumb:i,getOrganization:d,handelerCheckboxClick:e=>{r.value=r.value===e.id?0:e.id,Number(s.value.id)!==Number(e.id)?s.value=Object.assign({},s.value,e):s.value={id:null,name:""}},handlerGoNextLevel:e=>{const{id:t,name:c,children:a}=e;i.value.push({id:t,name:c}),u.value=a||[]},handlerDetermineClick:()=>{t("change",s.value)},handlerBreadCrumbClick:async()=>{i.value.pop();const{length:e}=i.value,{id:t}=i.value[e-1];await b(n.value,t)},handlerGoFirstLevel:()=>{u.value=n.value,i.value=[]}}}});c(277);var Se=_()(Re,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("van-icon"),o=Object(a.J)("van-checkbox"),r=Object(a.J)("van-button");return Object(a.C)(),Object(a.h)("div",ke,[Object(a.i)("div",ye,[Object(a.i)("span",{class:Object(a.t)(["van-ellipsis",{"is-multistage":e.isBreadCrumb.length}]),onClick:t[0]||(t[0]=(...t)=>e.handlerGoFirstLevel&&e.handlerGoFirstLevel(...t))}," 组织架构 ",2),e.isBreadCrumb.length?(Object(a.C)(),Object(a.h)("div",Ce,[1===e.isBreadCrumb.length?(Object(a.C)(),Object(a.h)("span",ge,[Object(a.k)(i,{name:"arrow",color:"#979ba5"}),Object(a.j)(" "+Object(a.N)(e.isBreadCrumb[0].name),1)])):Object(a.g)("",!0),e.isBreadCrumb.length>1?(Object(a.C)(),Object(a.h)("span",{key:1,class:"bread-crumb-item",onClick:t[1]||(t[1]=(...t)=>e.handlerBreadCrumbClick&&e.handlerBreadCrumbClick(...t))},[Object(a.k)(i,{name:"arrow",color:"#979ba5"}),Object(a.j)(" "+Object(a.N)("..."),1)])):Object(a.g)("",!0),e.isBreadCrumb.length>1?(Object(a.C)(),Object(a.h)("span",we,[Object(a.k)(i,{name:"arrow",color:"#979ba5"}),Object(a.j)(" "+Object(a.N)(e.isBreadCrumb[e.isBreadCrumb.length-1].name),1)])):Object(a.g)("",!0)])):Object(a.g)("",!0)]),Object(a.i)("div",Ne,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.organizationList,t=>(Object(a.C)(),Object(a.h)("div",{key:t.id,class:"content-item"},[Object(a.k)(o,{"model-value":e.isCheckedId===t.id,"label-disabled":!0,onClick:c=>e.handelerCheckboxClick(t)},{default:Object(a.T)(()=>[Object(a.k)(i,{name:"shrink"}),Object(a.j)(" "+Object(a.N)(t.name),1)]),_:2},1032,["model-value","onClick"]),t.children&&t.children.length?(Object(a.C)(),Object(a.f)(i,{key:0,name:"arrow",color:"#979ba5",onClick:c=>e.handlerGoNextLevel(t)},null,8,["onClick"])):Object(a.g)("",!0)]))),128))]),Object(a.i)("div",_e,[e.checkedInfo.name?(Object(a.C)(),Object(a.h)("span",Ie,"已选："+Object(a.N)(e.checkedInfo.name),1)):(Object(a.C)(),Object(a.h)("span",Te,"暂未选择")),Object(a.k)(r,{type:"primary",size:"normal",onClick:e.handlerDetermineClick},{default:Object(a.T)(()=>[Ee]),_:1},8,["onClick"])])])}],["__scopeId","data-v-0c14bfeb"]]);const De={class:"person-select"},xe={class:"select-title"},Ve={key:0},Fe={key:1},Me=Object(a.j)("已选人员 "),Pe={class:"color-blue"},Le={class:"select-body"},He={key:0,class:"person-list"},Je={class:"person-list search"},Ae={class:"person-name"},Be=["innerHTML"],Ue={key:1},qe={class:"select-footer"},Ge=Object(a.j)(" 已选： "),ze={class:"color-blue"},$e=Object(a.j)(" 收起 "),Qe=Object(a.j)("确定");var Ye=c(278),Ke=c.n(Ye),We=Object(a.l)({name:"PersonSelect",props:{show:{type:Boolean,default:!1},modelValue:{type:Array,default:()=>[]},inculde:{type:Array,default:()=>[]}},emits:["update:modelValue","close"],setup(e,{emit:t}){const{show:c,inculde:l}=Object(a.O)(e),n=Object(a.H)(!1);Object(a.R)(c,()=>{const e=l.value.length?l.value.join(","):"";r(e,!!l.value.length)});const s=Object(a.H)([]);Object(a.R)(s,e=>{t("update:modelValue",e)});const i=Object(a.H)(""),o=Object(a.H)([]),r=(e,t=!1)=>{((e,t=!1)=>{const c=(window.BK_USER_MANAGE_WEIXIN_HOST||location.origin)+"/api/c/compapi/v2/usermanage/fs_list_users/";return new Promise((a,l)=>{const n=`${c}?app_code=bk-magicbox&${t?"exact_lookups":"fuzzy_lookups"}=${e}&page_size=20&page=1`;Ke()(n,null,(e,t)=>{e?l(e):a(t.data.results)})})})(e,t).then(t=>{o.value=t.filter(e=>!(!l.value.length||!l.value.includes(e.username))).map(t=>{const c=new RegExp(e,"i"),a=`${t.username}(${t.display_name})`.replace(c,`<span style="color: #3a84ff;">${e}</span>`);return{...t,highlightName:a}})})},u=D(r,500);return{selected:s,searchList:o,cancelSelect:e=>{s.value.splice(e,1)},searchValue:i,showSelectedPerson:n,handelerSearchChange:e=>{u(e)},onSelectPerson:e=>{const t=s.value.find(t=>t.username===e.username);console.log(t,"target"),t?s.value=s.value.filter(t=>t.username!==e.username):s.value.push(e)},onClose:()=>{t("close",s.value)}}}});c(282);var Xe=_()(We,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("van-icon"),o=Object(a.J)("van-search"),r=Object(a.J)("van-checkbox"),u=Object(a.J)("van-button"),d=Object(a.J)("van-popup");return Object(a.C)(),Object(a.f)(d,{show:e.show,position:"bottom","lazy-render":!1},{default:Object(a.T)(()=>[Object(a.i)("div",De,[Object(a.i)("header",xe,[e.showSelectedPerson?(Object(a.C)(),Object(a.h)("span",Fe,[Me,Object(a.i)("span",Pe,Object(a.N)(e.selected.length),1)])):(Object(a.C)(),Object(a.h)("span",Ve,"选择成员"))]),Object(a.i)("div",Le,[e.showSelectedPerson?(Object(a.C)(),Object(a.h)("ul",He,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.selected,(t,c)=>(Object(a.C)(),Object(a.h)("li",{key:c,class:"person-item"},[Object(a.i)("span",null,Object(a.N)(t.username)+"("+Object(a.N)(t.display_name)+")",1),Object(a.k)(i,{class:"delete-person-icon",name:"cross",onClick:t=>e.cancelSelect(c)},null,8,["onClick"])]))),128))])):(Object(a.C)(),Object(a.h)(a.a,{key:1},[Object(a.k)(o,{modelValue:e.searchValue,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.searchValue=t),e.handelerSearchChange],shape:"round",placeholder:"请输入搜索关键词"},null,8,["modelValue","onUpdate:modelValue"]),Object(a.i)("ul",Je,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.searchList,t=>(Object(a.C)(),Object(a.h)("li",{key:t.username,class:"person-item"},[Object(a.i)("div",Ae,[Object(a.k)(r,{"model-value":e.selected.some(e=>e.username===t.username),class:"select-checkbox",onClick:c=>e.onSelectPerson(t)},null,8,["model-value","onClick"]),e.searchValue?(Object(a.C)(),Object(a.h)("span",{key:0,innerHTML:t.highlightName},null,8,Be)):(Object(a.C)(),Object(a.h)("span",Ue,Object(a.N)(t.username)+"("+Object(a.N)(t.display_name)+")",1))])]))),128))])],64))]),Object(a.i)("footer",qe,[e.showSelectedPerson?(Object(a.C)(),Object(a.h)("span",{key:1,onClick:t[2]||(t[2]=t=>e.showSelectedPerson=!1)},[$e,Object(a.k)(i,{class:"unfold-icon",name:"arrow-down"})])):(Object(a.C)(),Object(a.h)("span",{key:0,onClick:t[1]||(t[1]=t=>e.showSelectedPerson=!0)},[Ge,Object(a.i)("span",ze,Object(a.N)(e.selected.length),1),Object(a.k)(i,{class:"unfold-icon",name:"arrow-up"})])),Object(a.k)(u,{type:"primary",class:"confirm-button",onClick:e.onClose},{default:Object(a.T)(()=>[Qe]),_:1},8,["onClick"])])])]),_:1},8,["show"])}]]),Ze=c(18),et=Object(a.l)({name:"TransferOrder",components:{Organization:Se,PersonSelect:Xe},props:{firstInfo:{type:String,default:""},secondInfo:{type:Array,default:()=>[]},title:{type:Object,default:()=>({firstTitle:"转单至",secondTitle:"转单人",popupTitle:"选择转单角色"})},firstIncludeList:{type:Array,default:()=>[]},secondIncludeList:{type:Array,default:()=>[]}},emits:["update:firstInfo","update:secondInfo"],setup(e,{emit:t}){const c=Object(o.b)(),{firstInfo:l,secondInfo:n,title:s,firstIncludeList:i,secondIncludeList:r}=Object(a.O)(e),u=Object(a.H)(!1),d=Object(a.H)(!1),b=Object(a.H)(!1),O=Object(a.H)(!1),j=Object(a.H)(0),p=Object(a.H)({id:0,name:"",type:""}),v=Object(a.H)(""),m=Object(a.H)(n.value),f=Object(a.H)([]),h=Object(a.H)([]),k=Object(a.H)(!0),y=Object(a.H)(""),C=Object(a.d)(()=>n.value),g=Object(a.H)([]),w=Object(a.d)(()=>{const e=r.value.find(e=>"PERSON"===e.type);return e?e.list:[]}),N=async()=>{h.value=[];const{type:e}=p.value;if("PERSON"===e)return;const t=(await c.dispatch("ticket/getSecondUser",{shortcut:!0,role_type:e})).data.map(e=>(m.value.length&&m.value.includes(e.id)&&g.value.push(e.name),{id:e.id,name:e.name,type:e.id})),a=r.value.find(t=>t.type===e);h.value=a?t.filter(e=>a.list.some(t=>String(t)===String(e.id))):t,C.value.length&&(v.value=g.value.join("/"))},_=async()=>{await(async()=>{const e=(await c.dispatch("ticket/getUser",{is_processor:!0})).data.map(e=>({id:e.id,name:e.name,type:e.type})),t=i.value;t.length?f.value=e.filter(e=>t.includes(e.type)):f.value=e,l.value&&(p.value=f.value.find(e=>e.type===l.value)||{})})(),N()};_();const I=Object(a.H)(null),T=()=>{j.value=f.value.findIndex(e=>e.type===p.value.type),I.value.setColumnIndex(0,j.value)};return{showPersonSelect:O,isFirstPopup:k,pickerRef:I,showPopup:u,isShowOrg:b,isChangeType:d,noSecondTypeList:["EMPTY","OPEN","STARTER","BY_ASSIGNOR","STARTER_LEADER"],columnIndex:j,firstSelectedItem:p,searchValue:y,checkNames:g,secondDisplayName:v,checked:m,initList:_,firstLevelList:f,secondLevelList:h,handlerPopupOpen:()=>{u.value=!0,k.value=!0,Object(a.s)(()=>{T()})},handlerSecondPopupOpen:async e=>{if(p.value.type)if("PERSON"!==e){if(k.value=!1,"ORGANIZATION"===e)return b.value=!0,void(d.value=!1);h.value.length||await N(),u.value=!0}else O.value=!0;else Ze.a.emit("notify",{type:"warning",message:"请先选择"+s.value.firstTitle})},onConfirm:e=>{if(e){if(k.value){const{id:t}=p.value;t!==e.id&&(p.value=Object.assign({},p.value,e),d.value=!0,h.value=[],m.value=[],g.value=[],y.value="",v.value="",N())}else v.value=g.value.join("/");t("update:firstInfo",p.value.type),t("update:secondInfo",m.value),u.value=!1}},onCancel:()=>{u.value=!1},handelerOrgChange:e=>{b.value=!1,p.value={id:"10",name:"组织架构",type:"ORGANIZATION"};const c=[],{id:a,name:l,level:n}=e;c.push({id:a,name:l,level:n}),v.value=c.map(e=>e.name).join("/"),c.pop(),t("update:secondInfo",[a])},handelerCheckboxClick:()=>{g.value=m.value.map(e=>{const{name:t}=h.value.find(t=>t.id===e);return t})},handlePersonSelectClose:(e,c)=>{O.value=c,v.value=e.map(e=>`${e.username}(${e.display_name})`).join("/"),m.value=e.map(e=>e.username),t("update:secondInfo",m.value)},inculdePersons:w}}});c(283);var tt=_()(et,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("van-icon"),o=Object(a.J)("van-picker"),r=Object(a.J)("van-checkbox"),u=Object(a.J)("van-checkbox-group"),d=Object(a.J)("van-popup"),b=Object(a.J)("organization"),O=Object(a.J)("person-select");return Object(a.C)(),Object(a.h)("div",re,[Object(a.i)("div",ue,[Object(a.i)("span",de,Object(a.N)(e.title.firstTitle),1),Object(a.i)("div",{class:"content-right",onClick:t[0]||(t[0]=(...t)=>e.handlerPopupOpen&&e.handlerPopupOpen(...t))},[Object(a.i)("span",be,Object(a.N)(e.firstSelectedItem.name||"请选择"),1),Object(a.k)(i,{name:"arrow",color:"#8c8c8c"})])]),e.noSecondTypeList.includes(e.firstSelectedItem.type)?Object(a.g)("",!0):(Object(a.C)(),Object(a.h)("div",{key:0,class:Object(a.t)(["content-item",{"ban-operate":!e.firstSelectedItem.type}])},[Object(a.i)("span",Oe,Object(a.N)(e.firstSelectedItem.name||e.title.secondTitle),1),Object(a.i)("div",{class:"content-right",onClick:t[1]||(t[1]=t=>e.handlerSecondPopupOpen(e.firstSelectedItem.type))},[Object(a.i)("span",je,Object(a.N)(e.secondDisplayName||"请选择"),1),Object(a.k)(i,{name:"arrow",color:e.firstSelectedItem.type?"#8c8c8c":"#e5e6e9"},null,8,["color"])])],2)),Object(a.k)(d,{show:e.showPopup,position:"bottom","lazy-render":!1},{default:Object(a.T)(()=>[e.isFirstPopup?(Object(a.C)(),Object(a.f)(o,{key:0,ref:"pickerRef",title:e.title.popupTitle,"show-toolbar":"",columns:e.firstLevelList,"default-index":e.columnIndex,"value-key":"name",onConfirm:e.onConfirm,onCancel:e.onCancel},null,8,["title","columns","default-index","onConfirm","onCancel"])):(Object(a.C)(),Object(a.h)("div",pe,[Object(a.i)("div",ve,[Object(a.i)("span",{class:"cancel",onClick:t[2]||(t[2]=(...t)=>e.onCancel&&e.onCancel(...t))},"取消"),Object(a.i)("span",me,Object(a.N)(e.firstSelectedItem.name),1),Object(a.i)("span",{class:"confirm",onClick:t[3]||(t[3]=(...t)=>e.onConfirm&&e.onConfirm(...t))},"确认("+Object(a.N)(e.checked.length)+")",1)]),e.secondLevelList.length?(Object(a.C)(),Object(a.h)("div",fe,[Object(a.k)(u,{modelValue:e.checked,"onUpdate:modelValue":t[4]||(t[4]=t=>e.checked=t)},{default:Object(a.T)(()=>[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.secondLevelList,t=>(Object(a.C)(),Object(a.f)(r,{key:t.id,class:"column-item","label-disabled":!0,name:t.id,"icon-size":"24px",shape:"square",onClick:c=>e.handelerCheckboxClick(t.name)},{default:Object(a.T)(()=>[Object(a.i)("span",null,Object(a.N)(t.name),1)]),_:2},1032,["name","onClick"]))),128))]),_:1},8,["modelValue"])])):(Object(a.C)(),Object(a.h)("div",he,"暂无选项"))]))]),_:1},8,["show"]),Object(a.U)(Object(a.k)(b,{"is-change-type":e.isChangeType,onChange:e.handelerOrgChange},null,8,["is-change-type","onChange"]),[[a.Q,e.isShowOrg]]),Object(a.k)(O,{show:e.showPersonSelect,inculde:e.inculdePersons,onClose:t[5]||(t[5]=t=>e.handlePersonSelectClose(t,!1)),onCreated:t[6]||(t[6]=t=>e.handlePersonSelectClose(t,!0))},null,8,["show","inculde"])])}]]),ct=Object(a.l)({name:"CirculationPanel",components:{TransferOrder:tt},props:{operate:{type:Object,default:()=>({})},node:{type:Object,default:()=>({})},isBizNeed:{type:Boolean,default:!1}},emits:{cancel:null,confirm:e=>!!e},setup(e,{emit:t}){const{operate:c,node:l,isBizNeed:n}=Object(a.O)(e),{processors_type:s}=l.value,i=Object(a.d)(()=>"DELIVER"===c.value.key),o=i.value?"转单":"派单",r={firstTitle:o+"至",secondTitle:o+"人",popupTitle:`选择${o}人`},u=Object(a.G)({processorsType:s,processors:[],reason:""}),d=Object(a.G)({firstIncludeList:[],secondIncludeList:[]}),b=()=>{const{assignors:e,assignors_type:t,origin_assignors:c,delivers:a,delivers_type:s,origin_delivers:o}=l.value,r=i.value?a:e,u=i.value?o:c,b=i.value?s:t;if(["OPEN","BY_ASSIGNOR"].includes(b))d.firstIncludeList=["PERSON","GENERAL","ORGANIZATION"],d.secondIncludeList=[],i.value||d.firstIncludeList.push("STARTER"),n.value&&d.firstIncludeList.push("CMDB");else if("PERSON"===b)d.firstIncludeList=["PERSON"],d.secondIncludeList=u.split(",").filter(e=>!!e);else{d.firstIncludeList=["PERSON",b];const e=r.split(",").map(e=>e.replace(/\(.+\)/g,""));d.secondIncludeList=[{type:"PERSON",list:e},{type:b,list:u.split(",")}]}};return b(),{isDelive:i,formData:u,includeList:d,transferTitle:r,fastReason:["理由不充分","时间问题","更换处理人"],onConfirm:()=>{const{processorsType:e,processors:c,reason:a}=u;if(""===e)return void Ze.a.emit("notify",{type:"warning",message:`请选择${i.value?"转单":"派单"}角色类型`});if(!["EMPTY","OPEN","STARTER","BY_ASSIGNOR","STARTER_LEADER"].includes(e)&&0===c.length)return void Ze.a.emit("notify",{type:"warning",message:`请选择${i.value?"转单":"派单"}角色`});if(i.value&&""===a)return void Ze.a.emit("notify",{type:"warning",message:"请填写转单原因"});const l={reason:a,processors_type:e,processors:c.length>0?c.join(","):""};t("confirm",l)},initData:b}}});c(284);var at=_()(ct,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("van-button"),o=Object(a.J)("transfer-order"),r=Object(a.J)("van-field");return Object(a.C)(),Object(a.h)("div",ae,[Object(a.i)("div",le,[Object(a.i)("span",{class:"cancel-btn",onClick:t[0]||(t[0]=t=>e.$emit("cancel"))},"取消"),Object(a.k)(i,{type:"primary",class:"confirm-btn",onClick:e.onConfirm},{default:Object(a.T)(()=>[ne]),_:1},8,["onClick"])]),Object(a.i)("div",se,[Object(a.k)(o,{firstInfo:e.formData.processorsType,"onUpdate:firstInfo":t[1]||(t[1]=t=>e.formData.processorsType=t),secondInfo:e.formData.processors,"onUpdate:secondInfo":t[2]||(t[2]=t=>e.formData.processors=t),"first-include-list":e.includeList.firstIncludeList,"second-include-list":e.includeList.secondIncludeList,title:e.transferTitle},null,8,["firstInfo","secondInfo","first-include-list","second-include-list","title"])]),e.isDelive?(Object(a.C)(),Object(a.h)(a.a,{key:0},[Object(a.k)(r,{modelValue:e.formData.reason,"onUpdate:modelValue":t[3]||(t[3]=t=>e.formData.reason=t),class:"reason-textarea",type:"textarea",placeholder:"请输入转单原因",maxlength:"200",rows:"8","show-word-limit":""},null,8,["modelValue"]),Object(a.i)("div",ie,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.fastReason,(t,c)=>(Object(a.C)(),Object(a.h)("span",{Key:c,class:"reason-item",onClick:c=>e.formData.reason=t},Object(a.N)(t),9,oe))),256))])],64)):Object(a.g)("",!0)])}],["__scopeId","data-v-47343456"]]);const lt={class:"processed-node"},nt={key:0,class:"basic-info"},st={class:"node-processors"},it={class:"node-time"},ot={key:1,class:"node-detail"},rt={key:0,class:"multiple-process-item"},ut={class:"basic-info"},dt={class:"node-processors"},bt={class:"node-time"};var Ot=Object(a.l)({name:"ProcessedNode",components:{RenderField:H},props:{node:{type:Object,default:()=>({})},isMultipleProcessNode:{type:Boolean,default:!1},isSingleProcessNode:{type:Boolean,default:!1}},setup(e){const{node:t,isSingleProcessNode:c}=Object(a.O)(e),l=Object(a.H)(!1),n=Object(a.d)(()=>{let{processors:e,update_at:a,fields:l}=t.value;if(c.value&&"FINISHED"===t.value.status){const c=t.value.tasks.find(e=>"FINISHED"===e.status);e=c.processor,a=c.create_at,l=c.fields}return{processors:e,update_at:a,fields:l}});return{isExtended:l,commonData:n,toggleExtend:()=>{t.value.fields.length>0&&(l.value=!l.value)}}}});c(285);var jt=_()(Ot,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("van-icon"),o=Object(a.J)("render-field");return Object(a.C)(),Object(a.h)("div",lt,[Object(a.i)("p",{class:"node-name",onClick:t[0]||(t[0]=(...t)=>e.toggleExtend&&e.toggleExtend(...t))},[Object(a.j)(Object(a.N)(e.node.name)+" ",1),e.node.fields.length>0?(Object(a.C)(),Object(a.f)(i,{key:0,name:e.isExtended?"arrow-up":"arrow-down"},null,8,["name"])):Object(a.g)("",!0)]),e.isMultipleProcessNode?Object(a.g)("",!0):(Object(a.C)(),Object(a.h)("div",nt,[Object(a.i)("div",st,[Object(a.k)(i,{name:"user-circle-o"}),Object(a.j)(" "+Object(a.N)(e.commonData.processors),1)]),Object(a.i)("span",it,Object(a.N)(e.commonData.update_at),1)])),e.isExtended?(Object(a.C)(),Object(a.h)("div",ot,[e.isMultipleProcessNode?(Object(a.C)(!0),Object(a.h)(a.a,{key:1},Object(a.I)(e.node.tasks,(e,t)=>(Object(a.C)(),Object(a.h)(a.a,{key:t},["FINISHED"===e.status?(Object(a.C)(),Object(a.h)("div",rt,[Object(a.i)("div",ut,[Object(a.i)("div",dt,[Object(a.k)(i,{name:"user-circle-o"}),Object(a.j)(" "+Object(a.N)(e.processor),1)]),Object(a.i)("span",bt,Object(a.N)(e.create_at),1)]),Object(a.k)(o,{"is-view-mode":!0,fields:e.fields,class:Object(a.t)(["step-render-form",{"has-field":e.fields.length}])},null,8,["fields","class"])])):Object(a.g)("",!0)],64))),128)):(Object(a.C)(),Object(a.f)(o,{key:0,"is-view-mode":!0,fields:e.commonData.fields,class:Object(a.t)(["step-render-form",{"has-field":e.node.fields.length}])},null,8,["fields","class"]))])):Object(a.g)("",!0)])}],["__scopeId","data-v-843ddf7e"]]);const pt={class:"current-node-info"},vt={class:"node-name"},mt={key:0,class:"processor-wrap"},ft=(e=>(Object(a.F)("data-v-07656c31"),e=e(),Object(a.D)(),e))(()=>Object(a.i)("div",{class:"label"},"处理人",-1)),ht={class:"processors"},kt={key:1,class:"multiple-processor-wrap"},yt={class:"label"},Ct=Object(a.j)(" 处理人 "),gt={class:"processors"},wt={key:0,class:"status-icon"},Nt={key:0,class:"process-history"},_t={class:"basic-info"},It={class:"node-processors"},Tt={class:"node-time"};var Et=Object(a.l)({name:"ProcessedNode",components:{RenderField:H},props:{node:{type:Object,default:()=>({})},canOperate:{type:Boolean,default:!1}},setup(e){const{node:t}=Object(a.O)(e);return{isMultipleProcessNode:Object(a.d)(()=>{const{type:e,is_sequential:c,is_multi:a}=t.value;return"SIGN"===e&&c||"APPROVAL"===e&&a})}}});c(286);var Rt=_()(Et,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("van-icon"),o=Object(a.J)("render-field");return Object(a.C)(),Object(a.h)("div",pt,[Object(a.i)("p",vt,Object(a.N)(e.node.name),1),e.isMultipleProcessNode?(Object(a.C)(),Object(a.h)("div",kt,[Object(a.i)("div",yt,[Object(a.k)(i,{name:"user-circle-o"}),Ct]),Object(a.i)("div",gt,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.node.tasks,e=>(Object(a.C)(),Object(a.h)("span",{key:e,class:"processor-item"},[Object(a.j)(Object(a.N)(e.processor)+" ",1),"FINISHED"===e.status?(Object(a.C)(),Object(a.h)("span",wt,[Object(a.k)(i,{name:"success"})])):Object(a.g)("",!0)]))),128))]),e.canOperate?Object(a.g)("",!0):(Object(a.C)(!0),Object(a.h)(a.a,{key:0},Object(a.I)(e.node.tasks,(e,t)=>(Object(a.C)(),Object(a.h)(a.a,{key:t},["FINISHED"===e.status?(Object(a.C)(),Object(a.h)("div",Nt,[Object(a.i)("div",_t,[Object(a.i)("div",It,[Object(a.k)(i,{name:"user-circle-o"}),Object(a.j)(" "+Object(a.N)(e.processor),1)]),Object(a.i)("span",Tt,Object(a.N)(e.create_at),1)]),Object(a.k)(o,{"is-view-mode":!0,"highlight-refuse":!0,fields:e.fields,class:Object(a.t)(["step-render-form",{"has-field":e.fields.length}])},null,8,["fields","class"])])):Object(a.g)("",!0)],64))),128))])):(Object(a.C)(),Object(a.h)("div",mt,[Object(a.k)(i,{name:"user-circle-o"}),ft,Object(a.i)("div",ht,Object(a.N)(e.node.processors),1)]))])}],["__scopeId","data-v-07656c31"]]),St=Object(a.l)({name:"StepItem",components:{RenderField:H,CirculationPanel:at,ProcessedNode:jt,CurrentNodeInfo:Rt,TaskList:ce},props:{status:{type:String,default:""},id:{type:Number,default:0},node:{type:Object,default:()=>({})},isExtendSteps:{type:Boolean,default:!1},isBizNeed:{type:Boolean,default:!1}},emits:["update-nodes","toggle-extend"],setup(e,{emit:t}){const c=Object(o.b)(),{node:l,status:n,id:s}=Object(a.O)(e),i=Object(a.H)(!1),r=Object(a.H)({}),u=Object(a.H)(!1),d=Object(a.H)(""),b=Object(a.H)(""),O=Object(a.H)(!1),j=Object(a.H)(null);return{isExtended:i,isCurrentNode:Object(a.d)(()=>!["REVOKED","FINISHED"].includes(n.value)&&"RUNNING"===l.value.status),isMultipleProcessNode:Object(a.d)(()=>{const{type:e,is_sequential:t,is_multi:c}=l.value;return"SIGN"===e&&t||"APPROVAL"===e&&c}),isSingleProcessNode:Object(a.d)(()=>{const{type:e,is_sequential:t,is_multi:c}=l.value;return"SIGN"===e&&!t||"APPROVAL"===e&&!c}),isCirculationPanelShow:O,isSubmitDialogShow:u,submitDialogTitle:d,submitDialogMsg:b,renderField:j,operate:r,beforeSubmitClose:async e=>{if("cancel"===e)u.value=!1;else if("TRANSITION"===r.value.key){const e=j.value.getValue(),a={state_id:l.value.state_id,fields:e.map(e=>{const{type:t,value:c,id:a,key:l,choice:n}=e;return{id:a,key:l,type:t,choice:n,value:"FILE"===t?c.toString():c}})};try{await c.dispatch("ticket/proceed",{id:s.value,params:a}),t("update-nodes")}catch(e){console.error(e)}finally{r.value={},u.value=!1}}else if("CLAIM"===r.value.key){const e={state_id:l.value.state_id,action_type:"CLAIM",processors:window.username,processors_type:"PERSON"};try{await c.dispatch("ticket/operate",{id:s.value,params:e}),g.a.success({message:"提交成功",icon:"passed",className:"common-toast"}),t("update-nodes")}catch(e){console.log(e)}finally{r.value={},u.value=!1}}},handleOperateBtnClick:e=>{r.value=e;const t="TRANSITION"===r.value.key;let c=!0;t&&(j.value.hasNotSupportRequiredField()&&Object(g.a)({message:"有不支持的必填字段，请至PC端处理"}),c=j.value.validate()),c&&(["TRANSITION","CLAIM"].includes(r.value.key)?(u.value=!0,d.value=t?"是否提交":"是否认领",b.value=t?"提交后，流程将转入下一环节，当前提交的部分内容将无法修改":"执行认领操作后，单据将流入我的待办"):["DELIVER","DISTRIBUTE"].includes(r.value.key)&&(O.value=!0))},handleCirculation:async e=>{const a={state_id:l.value.state_id,action_type:r.value.key,processors:e.processors,processors_type:e.processors_type};"DELIVER"===r.value.key&&(a.action_message=e.reason);try{await c.dispatch("ticket/operate",{id:s.value,params:a}),t("update-nodes")}catch(e){console.error(e)}finally{O.value=!1}}}}});c(287);var Dt=_()(St,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("van-icon"),o=Object(a.J)("processed-node"),r=Object(a.J)("current-node-info"),u=Object(a.J)("task-list"),d=Object(a.J)("render-field"),b=Object(a.J)("van-button"),O=Object(a.J)("circulation-panel"),j=Object(a.J)("van-dialog");return Object(a.C)(),Object(a.h)("div",{class:Object(a.t)(["step-wrap",{is_current:e.isCurrentNode}])},["mobile-steps-button"===e.node.type?(Object(a.C)(),Object(a.h)(a.a,{key:0},[Object(a.i)("div",U,[Object(a.i)("i",{class:Object(a.t)(["itsm-mobile-icon",e.isExtendSteps?"icon-arrows-up":"icon-arrows-down"])},null,2)]),Object(a.i)("span",{class:"toggle-btn",onClick:t[0]||(t[0]=t=>e.$emit("toggle-extend"))},Object(a.N)(e.isExtendSteps?"收起前置节点":"展开前置节点"),1)],64)):(Object(a.C)(),Object(a.h)(a.a,{key:1},[Object(a.i)("div",q,[e.isCurrentNode?(Object(a.C)(),Object(a.h)("span",G)):(Object(a.C)(),Object(a.f)(i,{key:0,name:"passed"}))]),e.isCurrentNode?(Object(a.C)(),Object(a.h)(a.a,{key:1},[Object(a.k)(r,{node:e.node,"can-operate":e.node.can_operate},null,8,["node","can-operate"]),e.node.can_create_task||e.node.can_execute_task?(Object(a.C)(),Object(a.f)(u,{key:0,id:e.id},null,8,["id"])):Object(a.g)("",!0),e.node.can_operate?(Object(a.C)(),Object(a.f)(d,{key:1,ref:"renderField","is-view-mode":!e.isCurrentNode,fields:e.node.fields,class:Object(a.t)(["step-render-form",{"has-field":e.node.fields.length}])},null,8,["is-view-mode","fields","class"])):Object(a.g)("",!0),e.isCurrentNode&&e.node.operations.length>0&&e.node.can_operate?(Object(a.C)(),Object(a.h)("div",z,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.node.operations,(t,c)=>(Object(a.C)(),Object(a.h)(a.a,{key:t.key},[t.can_operate&&!["SUSPEND","TERMINATE"].includes(t.key)?(Object(a.C)(),Object(a.f)(b,{key:0,type:0===c?"primary":"default",plain:"",onClick:c=>e.handleOperateBtnClick(t)},{default:Object(a.T)(()=>[Object(a.j)(Object(a.N)(t.name),1)]),_:2},1032,["type","onClick"])):Object(a.g)("",!0)],64))),128))])):Object(a.g)("",!0)],64)):(Object(a.C)(),Object(a.f)(o,{key:0,node:e.node,"is-multiple-process-node":e.isMultipleProcessNode,"is-single-process-node":e.isSingleProcessNode},null,8,["node","is-multiple-process-node","is-single-process-node"]))],64)),e.isCirculationPanelShow?(Object(a.C)(),Object(a.h)("div",$,[Object(a.k)(O,{node:e.node,operate:e.operate,"is-biz-need":e.isBizNeed,onConfirm:e.handleCirculation,onCancel:t[1]||(t[1]=t=>e.isCirculationPanelShow=!1)},null,8,["node","operate","is-biz-need","onConfirm"])])):Object(a.g)("",!0),Object(a.k)(j,{show:e.isSubmitDialogShow,"onUpdate:show":t[2]||(t[2]=t=>e.isSubmitDialogShow=t),"class-name":"common-dialog","confirm-button-color":"#3a84ff","cancel-button-color":"#3a84ff",title:e.submitDialogTitle,"show-cancel-button":!0,"before-close":e.beforeSubmitClose},{default:Object(a.T)(()=>[Object(a.i)("div",Q,Object(a.N)(e.submitDialogMsg),1)]),_:1},8,["show","title","before-close"])],2)}],["__scopeId","data-v-df1dfbc8"]]),xt=Object(a.l)({name:"ProcessSteps",components:{StepItem:Dt},props:{nodeList:{type:Object,default:()=>({})},ticket:{type:Object,default:()=>({})}},emits:["update-nodes"],setup(e){const t=Object(a.H)([]),c=Object(a.H)(!1),{nodeList:l,ticket:n}=Object(a.O)(e),s=()=>{t.value=[];const e=l.value.filter(e=>"RUNNING"===e.status),a=l.value.length-e.length;if(!n.value.is_over&&"REVOKED"!==n.value.current_status&&a>1)if(c.value)t.value.push({type:"mobile-steps-button"},...l.value);else{const c=l.value[a-1];t.value.push({type:"mobile-steps-button"},c,...e)}else t.value=l.value.slice(0)};return Object(a.R)(l,()=>{s()},{deep:!0}),Object(a.R)(n,()=>{s()},{deep:!0}),s(),{steps:t,isExtendSteps:c,toggleNodesExtend:()=>{c.value=!c.value,s()}}}});var Vt=_()(xt,[["render",function(e,t,c,l,n,s){const i=Object(a.J)("step-item");return Object(a.C)(),Object(a.h)("div",B,[(Object(a.C)(!0),Object(a.h)(a.a,null,Object(a.I)(e.steps,c=>(Object(a.C)(),Object(a.f)(i,{id:e.ticket.id,key:`${c.id}_${c.status}`,status:e.ticket.current_status,"is-biz-need":e.ticket.is_biz_need,node:c,"is-extend-steps":e.isExtendSteps,onToggleExtend:e.toggleNodesExtend,onUpdateNodes:t[0]||(t[0]=t=>e.$emit("update-nodes"))},null,8,["id","status","is-biz-need","node","is-extend-steps","onToggleExtend"]))),128))])}]]),Ft=Object(a.l)({name:"Ticket",components:{ticketBaseInfo:I,createTicketInfo:A,processSteps:Vt},setup(){const e=Object(r.c)(),t=Object(o.b)(),c=Object(a.H)({}),l=Object(a.H)([]),n=Object(a.H)([]),s=Object(a.H)([]),i=Object(a.H)(!0),u=Object(a.H)(!0),b=Object(a.H)(!1),O=Object(a.H)(null),j=Object(a.H)(null),p=Object(a.H)(null),v=async()=>{try{i.value=!0;const a=await t.dispatch("ticket/getTicketDetail",{id:e.params.id});c.value=a.data}catch(e){console.error(e)}finally{i.value=!1}},m=async()=>{try{const c=await t.dispatch("ticket/getNodeList",{id:e.params.id});s.value=c.data[c.data.length-1].fields,c.data.forEach(e=>{n.value=[...n.value,...e.fields]}),l.value=c.data.reverse(),h(),await Object(a.s)(),y()}catch(e){console.error(e)}},f=async()=>{u.value=!0,v(),await m(),u.value=!1},h=()=>{void l.value.some(e=>{if(["TASK","TASK-SOPS"].includes(e.type)&&"RUNNING"===e.status)return!0;if("QUEUEING"===e.status)return!0;if(!1===e.is_schedule_ready)return!0;const t=e.tasks?e.tasks.find(e=>e.processor.replace(/\((.?)\)/,"")===window.username):{};return!!(["SIGN","APPROVAL"].includes(e.type)&&t&&["RUNNING","EXECUTED"].includes(t.status))})&&!O.value?O.value=setTimeout(()=>{m()},5e3):clearTimeout(O.value)},k=d()(()=>{const e=p.value.getBoundingClientRect();b.value=e.top<=0},300),y=()=>{j.value.addEventListener("scroll",k,!1)};return Object(a.w)(()=>{O.value&&clearTimeout(O.value),j.value.removeEventListener("scroll",k,!1)}),f(),{getNodeList:m,getTicketDetail:v,nodeList:l,ticketDetail:c,detailLoading:i,nodeListLoading:u,allFields:n,firstNodeFields:s,ticketPage:j,processDetail:p,processTitleFixed:b,onTicketRevoke:()=>{f()},handleClickFixedTitle:()=>{b.value&&(j.value.scrollTop=0)}}}});c(288);const Mt=_()(Ft,[["render",function(e,t,c,l,o,r){const u=Object(a.J)("ticket-base-info"),d=Object(a.J)("create-ticket-info"),b=Object(a.J)("process-steps"),O=Object(a.J)("van-loading"),j=Object(a.J)("van-skeleton");return Object(a.C)(),Object(a.f)(j,{row:16,"row-width":["100%","100%","30%","30%","0%","100%","100%","100%","0%","100%"],loading:e.detailLoading},{default:Object(a.T)(()=>[Object(a.i)("div",n,[Object(a.k)(u,{"ticket-detail":e.ticketDetail,onRevoke:e.onTicketRevoke},null,8,["ticket-detail","onRevoke"]),Object(a.k)(d,{"ticket-detail":e.ticketDetail,fields:e.firstNodeFields,"all-fields":e.allFields},null,8,["ticket-detail","fields","all-fields"]),Object(a.i)("div",{ref:"processDetail",class:Object(a.t)(["process-detail",{"title-fixed":e.processTitleFixed}])},[Object(a.i)("div",{class:"process-detail-title",onClick:t[0]||(t[0]=(...t)=>e.handleClickFixedTitle&&e.handleClickFixedTitle(...t))},s),e.nodeListLoading?(Object(a.C)(),Object(a.f)(O,{key:1,class:"node-list-loading",size:"40",color:"#3a84ff"})):(Object(a.C)(),Object(a.f)(b,{key:0,"node-list":e.nodeList,ticket:e.ticketDetail,onUpdateNodes:e.getNodeList},null,8,["node-list","ticket","onUpdateNodes"]))],2)],512),Object(a.i)("div",{class:"go-back-home",onClick:t[1]||(t[1]=t=>e.$router.push({name:"homeDefault"}))},i)]),_:1},8,["loading"])}],["__scopeId","data-v-42f080fb"]]);t.default=Mt}])]);